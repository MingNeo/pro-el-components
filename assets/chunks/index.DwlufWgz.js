import{fetchEvent as A}from"./fetch-event-source.cpGEww5t.js";import{v as F}from"./v4.C6aID195.js";import{D as I,p as n,h as K,x as O}from"./framework.igcgEEdr.js";import"./base.Dwgz6jSd.js";/* empty css                   */import"./index.BD-RLF64.js";import"./index.D353ODTN.js";import"./index.mDR6Kexr.js";import"./isSymbol.C7jn4vLP.js";import"./isObject.C3e4t58V.js";import"./types.DNi1ojkw.js";import"./icon.C3T6eoYR.js";import"./index.BQOwn3WU.js";import"./typescript.Bp3YSIOJ.js";import"./use-global-config.CrFx92Tt.js";import"./index.CRCbWsfX.js";import"./index.BjB1lFfg.js";import"./aria.9SHySdGF.js";function Z(D){const{url:E,method:b="post",headers:k,paramKey:x="content",formatPayload:h,formatResponse:R,onStart:i,onMessage:u,onFinish:l,onError:s,onCancel:m,resetOnFinish:S=!1}=D,r=I(),t=n("idle"),c=n(""),a=n(""),p=n(null),g=K(()=>["fetching","outputting"].includes(t.value));async function q(e){if(g.value)throw new Error("Stream is already running");try{f(),c.value=F(),r.value=new AbortController,t.value="fetching";const d=h?h(e):typeof e=="string"?{[x]:e}:e;i==null||i(),await A({url:E,method:b,headers:k,data:d,signal:r.value.signal,onMessage:y=>{t.value="outputting";try{const o=R(y)||"";o&&(a.value+=o,u==null||u(o,y))}catch(o){console.warn(o),w(new Error("Failed to process stream chunk"))}}}),t.value="completed",l==null||l(a.value),S&&f()}catch(d){w(d)}}function v(){r.value&&(r.value.abort(),r.value=void 0,t.value="idle",m==null||m())}function f(){v(),a.value="",p.value=null,t.value="idle",c.value=""}function w(e){p.value=e,t.value="error",s==null||s(e)}return O(()=>{v()}),{status:t,content:a,error:p,streamId:c,isStreaming:g,start:q,stop:v,reset:f}}export{Z as useStreamData};
