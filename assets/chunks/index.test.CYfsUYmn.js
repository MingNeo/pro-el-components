import{useTableList as s}from"./index.DKyQc_Ex.js";import{d as r,i as l,v as n,g as e}from"./vi.JYQecGiw.CsLlcVZs.js";import{p as d,P as v}from"./framework.igcgEEdr.js";import"./debounce.BwFge-ki.js";import"./isObject.C3e4t58V.js";import"./isSymbol.C7jn4vLP.js";import"./index.VGyafNOA.js";import"./commonjsHelpers.BosuxZz1.js";import"./vite-browser-external_commonjs-proxy.BC9WSf1a.js";r("useTableList",()=>{l("应该返回正确的响应式属性",()=>{const a=n.fn().mockResolvedValue({data:[],total:0}),t=s(a,{immediate:!1});e(t.data.value).toEqual([]),e(t.loading.value).toBe(!1),e(t.currentPage.value).toBe(1),e(t.pageSize.value).toBe(10),e(t.total.value).toBe(0),e(typeof t.fetchData).toBe("function"),e(typeof t.reset).toBe("function")}),l("immediate 为 true 时应该立即执行请求",async()=>{const a=n.fn().mockResolvedValue({data:[{id:1}],total:1});s(a,{immediate:!0}),await new Promise(t=>setTimeout(t,10)),e(a).toHaveBeenCalled()}),l("immediate 为 false 时不应该立即执行请求",()=>{const a=n.fn().mockResolvedValue({data:[],total:0});s(a,{immediate:!1}),e(a).not.toHaveBeenCalled()}),l("应该支持手动执行请求",async()=>{const a=[{id:1,name:"test"}],t=n.fn().mockImplementation(async()=>(await new Promise(u=>setTimeout(u,100)),{data:a,total:1})),{fetchData:i,data:o,loading:c}=s(t,{immediate:!1}),m=i();await new Promise(u=>setTimeout(u,10)),e(c.value).toBe(!0),await m,await new Promise(u=>setTimeout(u,150)),e(t).toHaveBeenCalled(),e(o.value).toEqual(a),e(c.value).toBe(!1)}),l("应该正确处理分页",async()=>{const a=n.fn().mockResolvedValue({data:[],total:100}),{changePageNo:t,changePageSize:i,currentPage:o,pageSize:c}=s(a,{immediate:!1});e(o.value).toBe(1),e(c.value).toBe(10),await t(2),await new Promise(m=>setTimeout(m,150)),e(o.value).toBe(2),i(20),await new Promise(m=>setTimeout(m,150)),e(c.value).toBe(20),e(o.value).toBe(1)}),l("应该正确处理搜索提交",async()=>{const a=n.fn().mockResolvedValue({data:[],total:0}),{search:t,currentPage:i}=s(a,{immediate:!1});await t.onSubmit({keyword:"test"}),await new Promise(o=>setTimeout(o,150)),e(i.value).toBe(1),e(a).toHaveBeenCalledWith(e.objectContaining({keyword:"test",pageNo:1,pageSize:10}))}),l("应该正确处理重置",async()=>{const a=n.fn().mockResolvedValue({data:[],total:0}),t=d({resetFields:n.fn()}),{reset:i,currentPage:o,changePageNo:c}=s(a,{immediate:!1,form:t,defaultPageSize:20});await c(3),await new Promise(m=>setTimeout(m,150)),i(),await new Promise(m=>setTimeout(m,150)),e(o.value).toBe(1),e(t.value.resetFields).toHaveBeenCalled()}),l("应该支持自定义 getData 和 getTotal",async()=>{const a=n.fn().mockResolvedValue({list:[{id:1}],count:100}),{data:t,total:i}=s(a,{getData:o=>o==null?void 0:o.list,getTotal:o=>o==null?void 0:o.count});await new Promise(o=>setTimeout(o,10)),e(t.value).toEqual([{id:1}]),e(i.value).toBe(100)}),l("应该正确处理排序变化",async()=>{const a=n.fn().mockResolvedValue({data:[],total:0}),{onSortChange:t,currentPage:i}=s(a,{immediate:!1});await t({prop:"name",order:"ascending"}),await new Promise(o=>setTimeout(o,150)),e(i.value).toBe(1),e(a).toHaveBeenCalledWith(e.objectContaining({sortBy:"name",order:"ascending"}))}),l("应该支持加载下一页",async()=>{const a=n.fn().mockResolvedValue({data:[],total:100}),{loadNextPage:t,currentPage:i}=s(a,{immediate:!1});e(i.value).toBe(1),await t(),await new Promise(o=>setTimeout(o,150)),e(i.value).toBe(2)}),l("应该支持数据合并模式",async()=>{let a=0;const t=n.fn().mockImplementation(async()=>(a++,{data:[{id:a}],total:10})),{data:i,loadNextPage:o}=s(t,{immediate:!0,mergeData:!0});await new Promise(c=>setTimeout(c,150)),e(i.value).toEqual([{id:1}]),await o(),await new Promise(c=>setTimeout(c,150)),e(i.value).toEqual([{id:1},{id:2}])}),l("应该支持数组格式的响应",async()=>{const a=[{id:1},{id:2}],t=n.fn().mockResolvedValue(a),{data:i,total:o}=s(t);await new Promise(c=>setTimeout(c,10)),e(i.value).toEqual(a),e(o.value).toBe(2)}),l("应该正确处理 defaultSearchData",async()=>{const a=n.fn().mockResolvedValue({data:[],total:0}),t={keyword:"test",pageNo:2,pageSize:20},{currentPage:i,pageSize:o,searchData:c}=s(a,{immediate:!1,defaultSearchData:t});e(i.value).toBe(2),e(o.value).toBe(20),e(c.value).toEqual(t)}),l("应该支持 onSearchDataChange 回调",async()=>{const a=n.fn(),t=n.fn().mockResolvedValue({data:[],total:0}),{search:i}=s(t,{immediate:!1,onSearchDataChange:a});await i.onSubmit({keyword:"test"}),await new Promise(o=>setTimeout(o,150)),e(a).toHaveBeenCalled()}),l("应该支持 onReset 回调",async()=>{const a=n.fn().mockReturnValue({defaultValue:"test"}),t=n.fn().mockResolvedValue({data:[],total:0}),{reset:i,searchData:o}=s(t,{immediate:!1,onReset:a});i(),await v(),e(a).toHaveBeenCalled(),e(o.value).toEqual({defaultValue:"test"})}),l("应该正确生成 pagination 对象",async()=>{const a=n.fn().mockResolvedValue({data:[],total:100}),{pagination:t,fetchData:i}=s(a,{immediate:!1});e(t.value).toEqual({currentPage:1,pageSize:10,total:0,onSizeChange:e.any(Function),onCurrentChange:e.any(Function)}),await i(),await new Promise(o=>setTimeout(o,10)),e(t.value.total).toBe(100)}),l("refetchOnReset 为 false 时重置不应该触发请求",()=>{const a=n.fn().mockResolvedValue({data:[],total:0}),{reset:t}=s(a,{immediate:!1,refetchOnReset:!1});t(),e(a).not.toHaveBeenCalled()}),l("应该防止重复加载",async()=>{const a=n.fn().mockImplementation(()=>new Promise(o=>setTimeout(()=>o({data:[],total:0}),100))),{loadNextPage:t,loading:i}=s(a,{immediate:!1});t(),await new Promise(o=>setTimeout(o,1)),e(i.value).toBe(!0),t(),await new Promise(o=>setTimeout(o,150)),e(a).toHaveBeenCalledTimes(1)})});
