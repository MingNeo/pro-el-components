import{t as R,p as D}from"./index.l2C8AFQu.js";import"./base.D1hT_OMg.js";import{E as M}from"./el-button.Ks_KV28J.js";import"./el-input.BSgJ4dcH.js";import{q as T,p as F,t as P,d as U}from"./pro-el-components.es.D2RWaTV6.js";import{v as h}from"./v4.C6aID195.js";import{E as A}from"./index.dVC2hAAQ.js";import{d as j,h as g,p as q,c as v,o as m,G as u,e as b,w as i,b as k,F as G,a as x,t as y,k as r,K,j as w}from"./framework.CCndWvNN.js";const S={class:"pro-table-form"},z={key:0,class:"pro-table-form-footer"},H={class:"flex items-center"},J={class:"total-row-text"},ee=j({name:"ProTableForm",inheritAttrs:!1,__name:"index",props:{propPrefix:{},modelValue:{},columns:{},viewMode:{type:Boolean}},emits:["update:modelValue","change","validate"],setup(C,{expose:I,emit:N}){const s=C,d=N,n=g(()=>{var t,e;return((e=(t=s.modelValue)==null?void 0:t.map)==null?void 0:e.call(t,(o,a)=>{const l=o.id||h();return{...o,_sortIndex:a,id:l}}))||[]}),c=q(1);function _(){const t=h(),e=[...n.value,...Array.from({length:c.value}).map(()=>({id:t}))].map((o,a)=>({...o,_sortIndex:a}));d("update:modelValue",e),d("change",e)}function V(t){const e=n.value.filter((o,a)=>a!==t).map((o,a)=>({...o,_sortIndex:a}));d("update:modelValue",e),d("change",e)}function B(t,e){const o=[...n.value];o[e]={...o[e],...t},d("update:modelValue",o),d("change",o)}const E=g(()=>[...s.columns,...s.viewMode?[]:[{label:"操作",prop:"actions",columnType:"actions",width:60,className:"pro-table-form-actions-column",actions:[{icon:R,onClick:(t,e,o)=>V(o),confirm:!0,confirmText:"确认删除?"}]}]]);return I({addRow:_,deleteRow:V}),(t,e)=>(m(),v("div",S,[u(r(P),K({columns:E.value,data:n.value},t.$attrs),{"column-default":i(({row:o,$index:a=0,column:l})=>[l.customRender?(m(),v(G,{key:0},[x(y(l.customRender(o,l,a)),1)],64)):l.columnType==="actions"&&!s.viewMode?(m(),k(r(T),{key:1,type:"link",actions:l.actions,record:o,column:l,index:a},null,8,["actions","record","column","index"])):a>=0?(m(),k(r(F),{key:2,modelValue:n.value[a],"onUpdate:modelValue":p=>n.value[a]=p,column:1,"prop-prefix":[s.propPrefix,a].flat(1/0),fields:[l].map(({customRender:p,...f})=>({...f,prop:f.prop||f.name})),"show-label":!1,"view-mode":s.viewMode,onChange:p=>B(p,a)},null,8,["modelValue","onUpdate:modelValue","prop-prefix","fields","view-mode","onChange"])):b("",!0)]),_:1},16,["columns","data"]),s.viewMode?b("",!0):(m(),v("div",z,[u(r(M),{class:"add-row-btn",onClick:_},{icon:i(()=>[u(r(A),null,{default:i(()=>[u(r(D))]),_:1})]),default:i(()=>[e[1]||(e[1]=x(" 添加行 "))]),_:1}),w("div",H,[u(r(U),{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),min:1},null,8,["modelValue"]),e[2]||(e[2]=w("span",{class:"row-text"},"行",-1))]),w("span",J,"当前总行数："+y(n.value.length),1)]))]))}});export{ee as _};
