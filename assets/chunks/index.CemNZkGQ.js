import{u as V}from"./index.D353ODTN.js";import{d as ae,a8 as we,p as I,aV as Pe,D as Ae,h as p,q as me,v as Ce,b as ve,o as y,w as g,G as d,T as Be,j as k,N as ye,n as v,k as e,e as E,c as N,r as x,Z as Ye,F as te,a as Me,t as Ee,H as Ve,B as Xe,a2 as De,a3 as Fe,P as Le,aU as He,ao as je,K as be,a1 as ke,ab as Ie,an as Ke}from"./framework.igcgEEdr.js";import{E as We,a as qe}from"./index.Brw29sq5.js";import{E as $}from"./icon.C3T6eoYR.js";import{y as Ze,z as Ge,o as Ue,e as Je,A as Qe,B as et,C as tt,D as at,E as st}from"./index.BQOwn3WU.js";import{b as ze,d as q,_ as _e,u as Se,w as Ne,f as ot}from"./base.Dwgz6jSd.js";import{m as Te}from"./typescript.Bp3YSIOJ.js";import{i as pe,d as nt}from"./types.DNi1ojkw.js";import{u as Oe}from"./index.BjB1lFfg.js";import{u as lt}from"./index.CRCbWsfX.js";import{E as M}from"./aria.9SHySdGF.js";import{k as rt}from"./use-global-config.CrFx92Tt.js";import{d as it}from"./debounce.BwFge-ki.js";import{i as ct}from"./isObject.C3e4t58V.js";import{a as X,p as ut}from"./index.mDR6Kexr.js";import{u as dt}from"./index.8K3Om35h.js";import{g as ft}from"./scroll.DxJqq-ED.js";var mt="Expected a function";function fe(s,f,o){var n=!0,r=!0;if(typeof s!="function")throw new TypeError(mt);return ct(o)&&(n="leading"in o?!!o.leading:n,r="trailing"in o?!!o.trailing:r),it(s,f,{leading:n,maxWait:f,trailing:r})}const vt=(s,f)=>{if(!X||!s||!f)return!1;const o=s.getBoundingClientRect();let n;return f instanceof Element?n=f.getBoundingClientRect():n={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},o.top<n.bottom&&o.bottom>n.top&&o.right>n.left&&o.left<n.right},Ft=s=>{let f,o;return s.type==="touchend"?(o=s.changedTouches[0].clientY,f=s.changedTouches[0].clientX):s.type.startsWith("touch")?(o=s.touches[0].clientY,f=s.touches[0].clientX):(o=s.clientY,f=s.clientX),{clientX:f,clientY:o}},pt=ze({urlList:{type:q(Array),default:()=>Te([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:q(String)}}),gt={close:()=>!0,switch:s=>pe(s),rotate:s=>pe(s)},ht=ae({name:"ElImageViewer"}),wt=ae({...ht,props:pt,emits:gt,setup(s,{expose:f,emit:o}){var n;const r=s,h={CONTAIN:{name:"contain",icon:we(Ge)},ORIGINAL:{name:"original",icon:we(Ze)}};let D,F="";const{t:se}=Oe(),l=Se("image-viewer"),{nextZIndex:P}=lt(),L=I(),Y=I([]),A=Pe(),m=I(!0),w=I(r.initialIndex),T=Ae(h.CONTAIN),c=I({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),oe=I((n=r.zIndex)!=null?n:P()),H=p(()=>{const{urlList:t}=r;return t.length<=1}),Z=p(()=>w.value===0),j=p(()=>w.value===r.urlList.length-1),K=p(()=>r.urlList[w.value]),ne=p(()=>[l.e("btn"),l.e("prev"),l.is("disabled",!r.infinite&&Z.value)]),le=p(()=>[l.e("btn"),l.e("next"),l.is("disabled",!r.infinite&&j.value)]),G=p(()=>{const{scale:t,deg:u,offsetX:i,offsetY:C,enableTransition:_}=c.value;let S=i/t,R=C/t;const W=u*Math.PI/180,ge=Math.cos(W),he=Math.sin(W);S=S*ge+R*he,R=R*ge-i/t*he;const de={transform:`scale(${t}) rotate(${u}deg) translate(${S}px, ${R}px)`,transition:_?"transform .3s":""};return T.value.name===h.CONTAIN.name&&(de.maxWidth=de.maxHeight="100%"),de}),U=p(()=>`${w.value+1} / ${r.urlList.length}`);function B(){Q(),D==null||D(),document.body.style.overflow=F,o("close")}function J(){const t=fe(i=>{switch(i.code){case M.esc:r.closeOnPressEscape&&B();break;case M.space:z();break;case M.left:ce();break;case M.up:O("zoomIn");break;case M.right:ue();break;case M.down:O("zoomOut");break}}),u=fe(i=>{const C=i.deltaY||i.deltaX;O(C<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});A.run(()=>{V(document,"keydown",t),V(document,"wheel",u)})}function Q(){A.stop()}function re(){m.value=!1}function ie(t){m.value=!1,t.target.alt=se("el.image.error")}function a(t){if(m.value||t.button!==0||!L.value)return;c.value.enableTransition=!1;const{offsetX:u,offsetY:i}=c.value,C=t.pageX,_=t.pageY,S=fe(W=>{c.value={...c.value,offsetX:u+W.pageX-C,offsetY:i+W.pageY-_}}),R=V(document,"mousemove",S);V(document,"mouseup",()=>{R()}),t.preventDefault()}function b(){c.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function z(){if(m.value)return;const t=rt(h),u=Object.values(h),i=T.value.name,_=(u.findIndex(S=>S.name===i)+1)%t.length;T.value=h[t[_]],b()}function ee(t){const u=r.urlList.length;w.value=(t+u)%u}function ce(){Z.value&&!r.infinite||ee(w.value-1)}function ue(){j.value&&!r.infinite||ee(w.value+1)}function O(t,u={}){if(m.value)return;const{minScale:i,maxScale:C}=r,{zoomRate:_,rotateDeg:S,enableTransition:R}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...u};switch(t){case"zoomOut":c.value.scale>i&&(c.value.scale=Number.parseFloat((c.value.scale/_).toFixed(3)));break;case"zoomIn":c.value.scale<C&&(c.value.scale=Number.parseFloat((c.value.scale*_).toFixed(3)));break;case"clockwise":c.value.deg+=S,o("rotate",c.value.deg);break;case"anticlockwise":c.value.deg-=S,o("rotate",c.value.deg);break}c.value.enableTransition=R}function Re(t){var u;((u=t.detail)==null?void 0:u.focusReason)==="pointer"&&t.preventDefault()}function $e(){r.closeOnPressEscape&&B()}function xe(t){if(t.ctrlKey){if(t.deltaY<0)return t.preventDefault(),!1;if(t.deltaY>0)return t.preventDefault(),!1}}return me(K,()=>{Le(()=>{const t=Y.value[0];t!=null&&t.complete||(m.value=!0)})}),me(w,t=>{b(),o("switch",t)}),Ce(()=>{J(),D=V("wheel",xe,{passive:!1}),F=document.body.style.overflow,document.body.style.overflow="hidden"}),f({setActiveItem:ee}),(t,u)=>(y(),ve(e(qe),{to:"body",disabled:!t.teleported},{default:g(()=>[d(Be,{name:"viewer-fade",appear:""},{default:g(()=>[k("div",{ref_key:"wrapper",ref:L,tabindex:-1,class:v(e(l).e("wrapper")),style:ye({zIndex:oe.value})},[d(e(We),{loop:"",trapped:"","focus-trap-el":L.value,"focus-start-el":"container",onFocusoutPrevented:Re,onReleaseRequested:$e},{default:g(()=>[k("div",{class:v(e(l).e("mask")),onClick:Ye(i=>t.hideOnClickModal&&B(),["self"])},null,10,["onClick"]),E(" CLOSE "),k("span",{class:v([e(l).e("btn"),e(l).e("close")]),onClick:B},[d(e($),null,{default:g(()=>[d(e(Ue))]),_:1})],2),E(" ARROW "),e(H)?E("v-if",!0):(y(),N(te,{key:0},[k("span",{class:v(e(ne)),onClick:ce},[d(e($),null,{default:g(()=>[d(e(Je))]),_:1})],2),k("span",{class:v(e(le)),onClick:ue},[d(e($),null,{default:g(()=>[d(e(Qe))]),_:1})],2)],64)),t.$slots.progress||t.showProgress?(y(),N("div",{key:1,class:v([e(l).e("btn"),e(l).e("progress")])},[x(t.$slots,"progress",{activeIndex:w.value,total:t.urlList.length},()=>[Me(Ee(e(U)),1)])],2)):E("v-if",!0),E(" ACTIONS "),k("div",{class:v([e(l).e("btn"),e(l).e("actions")])},[k("div",{class:v(e(l).e("actions__inner"))},[x(t.$slots,"toolbar",{actions:O,prev:ce,next:ue,reset:z,activeIndex:w.value,setActiveItem:ee},()=>[d(e($),{onClick:i=>O("zoomOut")},{default:g(()=>[d(e(et))]),_:1},8,["onClick"]),d(e($),{onClick:i=>O("zoomIn")},{default:g(()=>[d(e(tt))]),_:1},8,["onClick"]),k("i",{class:v(e(l).e("actions__divider"))},null,2),d(e($),{onClick:z},{default:g(()=>[(y(),ve(Ve(e(T).icon)))]),_:1}),k("i",{class:v(e(l).e("actions__divider"))},null,2),d(e($),{onClick:i=>O("anticlockwise")},{default:g(()=>[d(e(at))]),_:1},8,["onClick"]),d(e($),{onClick:i=>O("clockwise")},{default:g(()=>[d(e(st))]),_:1},8,["onClick"])])],2)],2),E(" CANVAS "),k("div",{class:v(e(l).e("canvas"))},[(y(!0),N(te,null,Xe(t.urlList,(i,C)=>De((y(),N("img",{ref_for:!0,ref:_=>Y.value[C]=_,key:i,src:i,style:ye(e(G)),class:v(e(l).e("img")),crossorigin:t.crossorigin,onLoad:re,onError:ie,onMousedown:a},null,46,["src","crossorigin"])),[[Fe,C===w.value]])),128))],2),x(t.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var yt=_e(wt,[["__file","image-viewer.vue"]]);const bt=Ne(yt),kt=ze({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:q([String,Object])},previewSrcList:{type:q(Array),default:()=>Te([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:q(String)}}),It={load:s=>s instanceof Event,error:s=>s instanceof Event,switch:s=>pe(s),close:()=>!0,show:()=>!0},Ct=ae({name:"ElImage",inheritAttrs:!1}),Et=ae({...Ct,props:kt,emits:It,setup(s,{expose:f,emit:o}){const n=s,{t:r}=Oe(),h=Se("image"),D=He(),F=p(()=>ot(Object.entries(D).filter(([a])=>/^(data-|on[A-Z])/i.test(a)||["id","style"].includes(a)))),se=dt({excludeListeners:!0,excludeKeys:p(()=>Object.keys(F.value))}),l=I(),P=I(!1),L=I(!0),Y=I(!1),A=I(),m=I(),w=X&&"loading"in HTMLImageElement.prototype;let T;const c=p(()=>[h.e("inner"),H.value&&h.e("preview"),L.value&&h.is("loading")]),oe=p(()=>{const{fit:a}=n;return X&&a?{objectFit:a}:{}}),H=p(()=>{const{previewSrcList:a}=n;return je(a)&&a.length>0}),Z=p(()=>{const{previewSrcList:a,initialIndex:b}=n;let z=b;return b>a.length-1&&(z=0),z}),j=p(()=>n.loading==="eager"?!1:!w&&n.loading==="lazy"||n.lazy),K=()=>{X&&(L.value=!0,P.value=!1,l.value=n.src)};function ne(a){L.value=!1,P.value=!1,o("load",a)}function le(a){L.value=!1,P.value=!0,o("error",a)}function G(){vt(A.value,m.value)&&(K(),J())}const U=ut(G,200,!0);async function B(){var a;if(!X)return;await Le();const{scrollContainer:b}=n;nt(b)?m.value=b:Ke(b)&&b!==""?m.value=(a=document.querySelector(b))!=null?a:void 0:A.value&&(m.value=ft(A.value)),m.value&&(T=V(m,"scroll",U),setTimeout(()=>G(),100))}function J(){!X||!m.value||!U||(T==null||T(),m.value=void 0)}function Q(){H.value&&(Y.value=!0,o("show"))}function re(){Y.value=!1,o("close")}function ie(a){o("switch",a)}return me(()=>n.src,()=>{j.value?(L.value=!0,P.value=!1,J(),B()):K()}),Ce(()=>{j.value?B():K()}),f({showPreview:Q}),(a,b)=>(y(),N("div",be({ref_key:"container",ref:A},e(F),{class:[e(h).b(),a.$attrs.class]}),[P.value?x(a.$slots,"error",{key:0},()=>[k("div",{class:v(e(h).e("error"))},Ee(e(r)("el.image.error")),3)]):(y(),N(te,{key:1},[l.value!==void 0?(y(),N("img",be({key:0},e(se),{src:l.value,loading:a.loading,style:e(oe),class:e(c),crossorigin:a.crossorigin,onClick:Q,onLoad:ne,onError:le}),null,16,["src","loading","crossorigin"])):E("v-if",!0),L.value?(y(),N("div",{key:1,class:v(e(h).e("wrapper"))},[x(a.$slots,"placeholder",{},()=>[k("div",{class:v(e(h).e("placeholder"))},null,2)])],2)):E("v-if",!0)],64)),e(H)?(y(),N(te,{key:2},[Y.value?(y(),ve(e(bt),{key:0,"z-index":a.zIndex,"initial-index":e(Z),infinite:a.infinite,"zoom-rate":a.zoomRate,"min-scale":a.minScale,"max-scale":a.maxScale,"show-progress":a.showProgress,"url-list":a.previewSrcList,crossorigin:a.crossorigin,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:re,onSwitch:ie},{progress:g(z=>[x(a.$slots,"progress",ke(Ie(z)))]),toolbar:g(z=>[x(a.$slots,"toolbar",ke(Ie(z)))]),default:g(()=>[a.$slots.viewer?(y(),N("div",{key:0},[x(a.$slots,"viewer")])):E("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):E("v-if",!0)],64)):E("v-if",!0)],16))}});var Lt=_e(Et,[["__file","image.vue"]]);const Ht=Ne(Lt);export{Ht as E,Ft as g};
