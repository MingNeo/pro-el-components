import{fetchEvent as A}from"./fetch-event-source.CbRBHF9v.js";import{v as F}from"./v4.C6aID195.js";import{D as I,p as n,h as K,x as O}from"./framework.CCndWvNN.js";import"./base.D1hT_OMg.js";/* empty css                   */import"./index.BeWdm9wy.js";import"./index.DT7TJvLG.js";import"./index.B1pLMPru.js";import"./isSymbol.C7jn4vLP.js";import"./isObject.C3e4t58V.js";import"./types.BG7Bq31m.js";import"./index.dVC2hAAQ.js";import"./icon.ZlYHZ6bL.js";import"./index.l2C8AFQu.js";import"./typescript.Bp3YSIOJ.js";import"./use-global-config.Cy85fLye.js";import"./index.CQNcN25s.js";import"./index.BTWm3S8P.js";import"./aria.9SHySdGF.js";function _(D){const{url:E,method:b="post",headers:k,paramKey:x="content",formatPayload:h,formatResponse:R,onStart:i,onMessage:u,onFinish:l,onError:s,onCancel:m,resetOnFinish:S=!1}=D,o=I(),t=n("idle"),c=n(""),a=n(""),p=n(null),g=K(()=>["fetching","outputting"].includes(t.value));async function q(e){if(g.value)throw new Error("Stream is already running");try{f(),c.value=F(),o.value=new AbortController,t.value="fetching";const d=h?h(e):typeof e=="string"?{[x]:e}:e;i==null||i(),await A({url:E,method:b,headers:k,data:d,signal:o.value.signal,onMessage:y=>{t.value="outputting";try{const r=R(y)||"";r&&(a.value+=r,u==null||u(r,y))}catch(r){console.log(r),w(new Error("Failed to process stream chunk"))}}}),t.value="completed",l==null||l(a.value),S&&f()}catch(d){w(d)}}function v(){o.value&&(o.value.abort(),o.value=void 0,t.value="idle",m==null||m())}function f(){v(),a.value="",p.value=null,t.value="idle",c.value=""}function w(e){p.value=e,t.value="error",s==null||s(e)}return O(()=>{v()}),{status:t,content:a,error:p,streamId:c,isStreaming:g,start:q,stop:v,reset:f}}export{_ as useStreamData};
