import"./base.Dwgz6jSd.js";/* empty css                     *//* empty css                *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{useRequest as J}from"./index.VGyafNOA.js";import{_ as P}from"./index.vue_vue_type_script_setup_true_lang.CR4Q-k9N.js";/* empty css                          */import"./el-input.DQ30HcuH.js";import"./el-popper.CZJRST1P.js";import"./el-tag.BDcJ6G_i.js";import"./el-checkbox.B0vmRW9S.js";/* empty css                 */import"./el-scrollbar.HZhNcw01.js";/* empty css                          *//* empty css                   *//* empty css              */import"./el-button.k3Ms4Xdh.js";/* empty css                   *//* empty css              */import"./dayjs.min.Ba62AOpW.js";/* empty css                        */import"./el-tooltip.l0sNRNKZ.js";/* empty css                  */import"./el-select.D9tonctu.js";/* empty css                    */import{_ as I}from"./index.vue_vue_type_script_setup_true_lang.Cm45yPGm.js";/* empty css              */import{_ as O}from"./index.vue_vue_type_script_setup_true_lang.DWb0jxax.js";/* empty css              *//* empty css              *//* empty css                       */import{_ as Q}from"./index.vue_vue_type_script_setup_true_lang.DgUHcPJC.js";/* empty css              *//* empty css              *//* empty css              */import"./el-table-column.BBssXNKa.js";/* empty css                    *//* empty css                                                      *//* empty css              *//* empty css              */import{v as T}from"./directive.CEBmWU5B.js";import{E as W}from"./index.DbWT0aQr.js";import{d as X,p as w,h as C,$ as Y,q as D,c as d,o as r,r as m,a2 as Z,e as p,G as $,w as R,b as v,k as s,n as q,F as _,B as x,a6 as ee}from"./framework.igcgEEdr.js";const te={class:"pro-detail-page"},ae={key:0,class:"pro-detail-card"},Xe=X({name:"ProDetailPage",__name:"index",props:{title:{},defaultValue:{default:()=>({})},formData:{},viewMode:{type:Boolean},type:{},fields:{},extraFields:{},column:{default:2},formItemProps:{},idKey:{},loading:{type:Boolean},headerActions:{},footerActions:{},footerClass:{},showFooter:{type:Boolean,default:!0},contentClass:{},getDataService:{},updateService:{},createService:{}},emits:["update:visible","ok","update:formData","submit","back"],setup(z,{expose:G,emit:K}){var F;const a=z,i=K,f=ee(),g=(F=f==null?void 0:f.vnode)!=null&&F.props?"formData"in f.vnode.props||"form-data"in f.vnode.props:!!a.formData,c=w(),t=w(g?a.formData:a.defaultValue),l=C(()=>a.type??(a.viewMode?"detail":t.value[a.idKey||"id"]?"edit":"create")),{execute:h,isLoading:b}=J(async(...e)=>{var o;return await((o=l.value==="edit"?a.updateService:a.createService)==null?void 0:o(...e))},{immediate:!1}),S=C(()=>{var e;return l.value==="detail"?[]:((Array.isArray(a.footerActions)?a.footerActions:(e=a.footerActions)==null?void 0:e.call(a,{submit:V,cancel:A,submitLoading:b.value}))||[{text:"取消",onClick:A},{text:"提交",type:"primary",loading:b.value,onClick:V}]).map(o=>({...o,args:[t]}))}),{footer:N}=Y(),U=C(()=>{var e;return(a.showFooter??l.value!=="detail")&&!!((e=S.value)!=null&&e.length||N)});g||D(()=>a.defaultValue,e=>{t.value=e,i("update:formData",t.value)},{deep:!0}),D(()=>a.formData,e=>t.value=e,{deep:!0});const y=w(!1);D(l,e=>{if(!e||e!=="create"){a.getDataService&&(y.value=!0,a.getDataService().then(o=>{t.value=o,i("update:formData",t.value)}).finally(()=>{y.value=!1}));return}t.value=g?a.formData:a.defaultValue},{immediate:!0});async function V(){if(l.value!=="detail")try{const e=await c.value.validate();i("update:formData",t.value),await(h==null?void 0:h(t.value)),i("submit",e),i("ok",t.value)}catch(e){console.log("error",e)}}function A(){i("back")}function k(e,o=!1){t.value=o?{...t.value,...e}:e,i("update:formData",t.value)}async function H(e=[]){e!=null&&e.length&&await c.value.validate(e),await c.value.validate()}return G({validField:H}),(e,o)=>(r(),d("div",te,[m(e.$slots,"header",{},()=>[$(s(O),{title:typeof e.title=="function"?e.title(l.value):e.title,"show-back":!0,onCancel:o[0]||(o[0]=u=>i("back"))},{actions:R(()=>[m(e.$slots,"headerActions",{},()=>{var u;return[(u=e.headerActions)!=null&&u.length?(r(),v(s(P),{key:0,actions:e.headerActions},null,8,["actions"])):p("",!0)]})]),_:3},8,["title"])]),Z((r(),d("div",{class:q(`page-detail-content page-container ${e.contentClass||""}`)},[$(s(W),{ref_key:"formRef",ref:c,model:t.value,"label-width":"auto","label-position":"right"},{default:R(()=>[m(e.$slots,"contentHeader"),m(e.$slots,"default",{data:t.value,onChange:k,formRef:c.value},()=>{var u,B,E;return[(u=e.fields)!=null&&u.length||(B=e.extraFields)!=null&&B.length||e.$slots.contentExtra?(r(),d("div",ae,[(E=e.fields)!=null&&E.length?(r(),v(s(I),{key:0,modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=n=>t.value=n),column:e.column,"view-mode":l.value==="detail",fields:e.fields,"form-item-props":e.formItemProps,onChange:k},null,8,["modelValue","column","view-mode","fields","form-item-props"])):p("",!0),(r(!0),d(_,null,x(e.extraFields,(n,M)=>{var L;return r(),d("div",{key:M,class:"extra-field-section"},[n.title?(r(),v(s(Q),{key:0,class:"extra-field-header",title:n.title,actions:n.actions},null,8,["title","actions"])):p("",!0),(L=n.fields)!=null&&L.length?(r(),v(s(I),{key:1,modelValue:t.value,"onUpdate:modelValue":o[2]||(o[2]=j=>t.value=j),column:e.column,"view-mode":l.value==="detail",fields:n.fields,"form-item-props":e.formItemProps,onChange:k},null,8,["modelValue","column","view-mode","fields","form-item-props"])):p("",!0)])}),128)),m(e.$slots,"contentExtra")])):p("",!0)]}),m(e.$slots,"pageExtra")]),_:3},8,["model"])],2)),[[s(T),e.loading||y.value]]),U.value?(r(),d("div",{key:0,class:q(`page-detail-footer ${e.footerClass||""}`)},[m(e.$slots,"footer",{},()=>[$(s(P),{type:"button",size:"default",actions:S.value,args:[t.value]},null,8,["actions","args"])])],2)):p("",!0)]))}});export{Xe as _};
