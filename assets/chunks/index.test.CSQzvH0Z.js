const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/fetch-event-source.cpGEww5t.js","assets/chunks/base.Dwgz6jSd.js","assets/chunks/framework.igcgEEdr.js","assets/chunks/index.BD-RLF64.js","assets/chunks/index.D353ODTN.js","assets/chunks/index.mDR6Kexr.js","assets/chunks/isSymbol.C7jn4vLP.js","assets/chunks/isObject.C3e4t58V.js","assets/chunks/types.DNi1ojkw.js","assets/chunks/icon.C3T6eoYR.js","assets/chunks/index.BQOwn3WU.js","assets/chunks/typescript.Bp3YSIOJ.js","assets/chunks/use-global-config.CrFx92Tt.js","assets/chunks/index.CRCbWsfX.js","assets/chunks/index.BjB1lFfg.js","assets/chunks/aria.9SHySdGF.js"])))=>i.map(i=>d[i]);
import{P as c,a0 as p}from"./framework.igcgEEdr.js";import{useStreamData as r}from"./index.DwlufWgz.js";import{v,d as h,i,g as a}from"./vi.JYQecGiw.CsLlcVZs.js";import"./fetch-event-source.cpGEww5t.js";import"./base.Dwgz6jSd.js";/* empty css                   */import"./index.BD-RLF64.js";import"./index.D353ODTN.js";import"./index.mDR6Kexr.js";import"./isSymbol.C7jn4vLP.js";import"./isObject.C3e4t58V.js";import"./types.DNi1ojkw.js";import"./icon.C3T6eoYR.js";import"./index.BQOwn3WU.js";import"./typescript.Bp3YSIOJ.js";import"./use-global-config.CrFx92Tt.js";import"./index.CRCbWsfX.js";import"./index.BjB1lFfg.js";import"./aria.9SHySdGF.js";import"./v4.C6aID195.js";import"./commonjsHelpers.BosuxZz1.js";import"./vite-browser-external_commonjs-proxy.BC9WSf1a.js";v.mock("../fetch-event-source",()=>({fetchEvent:v.fn()}));h("useStreamData",()=>{const n={url:"/api/stream",formatResponse:t=>{var e;return((e=t.data)==null?void 0:e.result)||""}};i("应该返回正确的响应式属性",()=>{const{status:t,content:e,error:o,streamId:s,isStreaming:m,start:u,stop:l,reset:d}=r(n);a(t.value).toBe("idle"),a(e.value).toBe(""),a(o.value).toBe(null),a(s.value).toBe(""),a(m.value).toBe(!1),a(typeof u).toBe("function"),a(typeof l).toBe("function"),a(typeof d).toBe("function")}),i("应该在 start 时更新状态",async()=>{const{start:t,status:e,streamId:o}=r(n),s=t({content:"test"});a(e.value).toBe("fetching"),a(o.value).not.toBe(""),a(typeof o.value).toBe("string"),await s.catch(()=>{})}),i("应该在流处理中时 isStreaming 为 true",async()=>{const{start:t,isStreaming:e}=r(n),o=t("test");a(e.value).toBe(!0),await o.catch(()=>{})}),i("应该正确调用 onStart 回调",async()=>{const t=v.fn(),{start:e}=r({...n,onStart:t}),o=e("test");await c(),a(t).toHaveBeenCalled(),await o.catch(()=>{})}),i("应该支持字符串格式的 payload",async()=>{const{start:t}=r({...n,paramKey:"text"}),e=t("test string");await c();const{fetchEvent:o}=await p(async()=>{const{fetchEvent:s}=await import("./fetch-event-source.cpGEww5t.js");return{fetchEvent:s}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]));a(o).toHaveBeenCalledWith(a.objectContaining({data:{text:"test string"}})),await e.catch(()=>{})}),i("应该支持对象格式的 payload",async()=>{const{start:t}=r(n),e={content:"test",userId:"123"},o=t(e);await c();const{fetchEvent:s}=await p(async()=>{const{fetchEvent:m}=await import("./fetch-event-source.cpGEww5t.js");return{fetchEvent:m}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]));a(s).toHaveBeenCalledWith(a.objectContaining({data:e})),await o.catch(()=>{})}),i("应该支持 formatPayload 自定义格式化",async()=>{const t=v.fn(s=>({customField:s})),{start:e}=r({...n,formatPayload:t}),o=e({content:"test"});await c(),a(t).toHaveBeenCalledWith({content:"test"}),await o.catch(()=>{})}),i("应该在已经流处理时抛出错误",async()=>{const{start:t,isStreaming:e}=r(n),o=t("test1");a(e.value).toBe(!0),await a(t("test2")).rejects.toThrow("Stream is already running"),await o.catch(()=>{})}),i("应该支持 stop 停止流",async()=>{const t=v.fn(),{start:e,stop:o,status:s}=r({...n,onCancel:t}),m=e("test");await c(),o(),await c(),a(s.value).toBe("idle"),a(t).toHaveBeenCalled(),await m.catch(()=>{})}),i("应该支持 reset 重置状态",async()=>{const{start:t,reset:e,content:o,status:s,streamId:m,error:u}=r(n),l=t("test");await c(),e(),await c(),a(o.value).toBe(""),a(s.value).toBe("idle"),a(m.value).toBe(""),a(u.value).toBe(null),await l.catch(()=>{})}),i("应该正确处理不同的 HTTP 方法",async()=>{const{start:t}=r({...n,method:"get"}),e=t("test");await c();const{fetchEvent:o}=await p(async()=>{const{fetchEvent:s}=await import("./fetch-event-source.cpGEww5t.js");return{fetchEvent:s}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]));a(o).toHaveBeenCalledWith(a.objectContaining({method:"get"})),await e.catch(()=>{})}),i("应该支持自定义 headers",async()=>{const t={Authorization:"Bearer token"},{start:e}=r({...n,headers:t}),o=e("test");await c();const{fetchEvent:s}=await p(async()=>{const{fetchEvent:m}=await import("./fetch-event-source.cpGEww5t.js");return{fetchEvent:m}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]));a(s).toHaveBeenCalledWith(a.objectContaining({headers:t})),await o.catch(()=>{})}),i("每次 start 应该生成新的 streamId",async()=>{const{start:t,streamId:e,reset:o}=r(n),s=t("test1");await c();const m=e.value;o(),await c();const u=t("test2");await c();const l=e.value;a(m).not.toBe(""),a(l).not.toBe(""),a(m).not.toBe(l),await s.catch(()=>{}),await u.catch(()=>{})}),i("应该支持 resetOnFinish 选项",()=>{const{content:t}=r({...n,resetOnFinish:!0});a(t.value).toBe("")}),i("应该支持自定义 paramKey",async()=>{const{start:t}=r({...n,paramKey:"message"}),e=t("test");await c();const{fetchEvent:o}=await p(async()=>{const{fetchEvent:s}=await import("./fetch-event-source.cpGEww5t.js");return{fetchEvent:s}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]));a(o).toHaveBeenCalledWith(a.objectContaining({data:{message:"test"}})),await e.catch(()=>{})})});
