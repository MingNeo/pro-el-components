import{fetchEvent as A}from"./fetch-event-source.DyJcgphX.js";import{v as F}from"./v4.C6aID195.js";import{D as I,p as n,h as K,x as O}from"./framework.C7SOrqHQ.js";import"./base.BdmgHdsK.js";/* empty css                   */import"./index.WZ0sw04i.js";import"./index.BxHDt7Km.js";import"./index.126dwtby.js";import"./isSymbol.C7jn4vLP.js";import"./isObject.C3e4t58V.js";import"./types.CHlFyNtD.js";import"./index.RKxNzSBd.js";import"./icon.D1paMUUC.js";import"./index.CacP4YLb.js";import"./typescript.Bp3YSIOJ.js";import"./use-global-config.DIWKgMVJ.js";import"./index.hhTD2MZf.js";import"./index.CQ2QlRVi.js";import"./aria.9SHySdGF.js";function _(D){const{url:E,method:b="post",headers:k,paramKey:x="content",formatPayload:h,formatResponse:R,onStart:i,onMessage:u,onFinish:l,onError:s,onCancel:m,resetOnFinish:S=!1}=D,o=I(),t=n("idle"),c=n(""),a=n(""),p=n(null),g=K(()=>["fetching","outputting"].includes(t.value));async function q(e){if(g.value)throw new Error("Stream is already running");try{f(),c.value=F(),o.value=new AbortController,t.value="fetching";const d=h?h(e):typeof e=="string"?{[x]:e}:e;i==null||i(),await A({url:E,method:b,headers:k,data:d,signal:o.value.signal,onMessage:y=>{t.value="outputting";try{const r=R(y)||"";r&&(a.value+=r,u==null||u(r,y))}catch(r){console.log(r),w(new Error("Failed to process stream chunk"))}}}),t.value="completed",l==null||l(a.value),S&&f()}catch(d){w(d)}}function v(){o.value&&(o.value.abort(),o.value=void 0,t.value="idle",m==null||m())}function f(){v(),a.value="",p.value=null,t.value="idle",c.value=""}function w(e){p.value=e,t.value="error",s==null||s(e)}return O(()=>{v()}),{status:t,content:a,error:p,streamId:c,isStreaming:g,start:q,stop:v,reset:f}}export{_ as useStreamData};
