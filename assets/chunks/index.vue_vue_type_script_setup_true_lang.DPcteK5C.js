import"./base.Dwgz6jSd.js";import{b as P,E as M,a as R}from"./el-select.D9tonctu.js";import"./el-tag.BDcJ6G_i.js";import"./el-scrollbar.HZhNcw01.js";import"./el-popper.CZJRST1P.js";import{d as y}from"./debounce.BwFge-ki.js";import{b as T}from"./baseUniq.CpJglj-j.js";import{d as _,p as i,v as F,q as S,b as k,c as w,o as c,w as B,B as H,k as r,F as V,a as L,t as O,K as $}from"./framework.igcgEEdr.js";import{useRequest as j}from"./index.VGyafNOA.js";function q(s,m){return s&&s.length?T(s,P(m)):[]}const Z=_({name:"ProRemoteSelect",inheritAttrs:!1,__name:"index",props:{service:{},fillBackService:{},optionNames:{default:()=>({label:"name",value:"id"})},defaultOptions:{},searchInLocal:{type:Boolean,default:!1},searchKey:{default:"keyword"},viewMode:{type:Boolean},onOptionsChanged:{},deps:{},modelValue:{},multiple:{type:Boolean}},emits:["loaded","firstLoaded"],setup(s,{emit:m}){const e=s,f=m,p=i(1),v=i(0),h=i(""),g=i(0),l=i([]),{execute:C,isLoading:N}=j(e.service,{immediate:!1});function d(a=[]){return a.map(o=>({...o,[`_${e.optionNames.label}`]:o[e.optionNames.label],[e.optionNames.label]:o[e.optionNames.label]}))}async function u(a=!1){var t;const o={pageNo:p.value,pageSize:10};a&&e.searchKey&&(o[e.searchKey]=h.value);try{const n=await C(o),b=d(n==null?void 0:n.data);l.value=a?b:q([...l.value,...b].reverse(),e.optionNames.value).reverse(),(t=e.onOptionsChanged)==null||t.call(e,l.value),v.value=(n==null?void 0:n.total)??0,f("loaded",l.value),g.value===0&&f("firstLoaded",l.value),g.value++}catch(n){console.error("RemoteSelect fetchData error",n)}}F(()=>{l.value=d(e.defaultOptions),u()}),S(()=>e.modelValue,async a=>{var t;const o=a!==void 0?e.multiple?a:[a]:[];if(o.length){const n=await((t=e.fillBackService)==null?void 0:t.call(e,o))||[];l.value=q([...l.value,...d(n)],e.optionNames.value)}},{immediate:!0}),S(()=>e.deps,()=>u(!0));const D=y(()=>{const a=document.querySelector(".el-select-dropdown__wrap");a&&a.scrollHeight-a.scrollTop===a.clientHeight&&l.value.length<v.value&&(p.value++,u())},500,{leading:!0,trailing:!1}),E=y(()=>{p.value=1,u(!0)},1e3);function I(a){h.value=a,e.searchInLocal||E()}function K(){var a;return e.modelValue?e.multiple?e.modelValue.map(o=>{var t;return((t=l.value.find(n=>n[e.optionNames.value]===o))==null?void 0:t[e.optionNames.label])||o}).join("；"):((a=l.value.find(o=>o[e.optionNames.value]===e.modelValue))==null?void 0:a[e.optionNames.label])||e.modelValue:"-无-"}return(a,o)=>a.viewMode?(c(),w(V,{key:1},[L(O(K()),1)],64)):(c(),k(r(R),$({key:0,"model-value":a.modelValue,multiple:a.multiple},a.$attrs,{loading:r(N),remote:!a.searchInLocal,"remote-method":I,onPopupScroll:r(D)}),{empty:B(()=>[L(O(r(N)?"":"无数据"),1)]),default:B(()=>[(c(!0),w(V,null,H(l.value,t=>(c(),k(r(M),{key:t[a.optionNames.value],label:t[a.optionNames.label],value:t[a.optionNames.value]},null,8,["label","value"]))),128))]),_:1},16,["model-value","multiple","loading","remote","onPopupScroll"]))}});export{Z as _};
