import{i as q,d as re}from"./types.BG7Bq31m.js";import{v as N,Y as I,p as _,d as ee,r as k,q as A,k as m,P as M,ap as ae,V as ce,b as ue,o as ie,aX as de}from"./framework.CCndWvNN.js";import{_ as te,a as fe,d as le,w as ve}from"./base.D1hT_OMg.js";import{E as ne}from"./aria.9SHySdGF.js";import{a as j}from"./index.B1pLMPru.js";function De(e){return e===void 0}const pe=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.tabIndex<0||e.hasAttribute("disabled")||e.getAttribute("aria-disabled")==="true")return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},Be=function(e,t,...o){let s;t.includes("mouse")||t.includes("click")?s="MouseEvents":t.includes("key")?s="KeyboardEvent":s="HTMLEvents";const a=document.createEvent(s);return a.initEvent(t,...o),e.dispatchEvent(a),e},Ee=e=>!e.getAttribute("aria-owns"),$e=(e,t,o)=>{const{parentNode:s}=e;if(!s)return null;const a=s.querySelectorAll(o),c=Array.prototype.indexOf.call(a,e);return a[c+t]||null},He=e=>{e&&(e.focus(),!Ee(e)&&e.click())},C="focus-trap.focus-after-trapped",O="focus-trap.focus-after-released",Te="focus-trap.focusout-prevented",W={cancelable:!0,bubbles:!1},me={cancelable:!0,bubbles:!1},X="focusAfterTrapped",Y="focusAfterReleased",be=Symbol("elFocusTrap"),R=_(),P=_(0),U=_(0);let b=0;const se=e=>{const t=[],o=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const a=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||a?NodeFilter.FILTER_SKIP:s.tabIndex>=0||s===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;o.nextNode();)t.push(o.currentNode);return t},J=(e,t)=>{for(const o of e)if(!Fe(o,t))return o},Fe=(e,t)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},ye=e=>{const t=se(e),o=J(t,e),s=J(t.reverse(),e);return[o,s]},_e=e=>e instanceof HTMLInputElement&&"select"in e,l=(e,t)=>{if(e&&e.focus){const o=document.activeElement;let s=!1;q(e)&&!pe(e)&&!e.getAttribute("tabindex")&&(e.setAttribute("tabindex","-1"),s=!0),e.focus({preventScroll:!0}),U.value=window.performance.now(),e!==o&&_e(e)&&t&&e.select(),q(e)&&s&&e.removeAttribute("tabindex")}};function z(e,t){const o=[...e],s=e.indexOf(t);return s!==-1&&o.splice(s,1),o}const Pe=()=>{let e=[];return{push:s=>{const a=e[0];a&&s!==a&&a.pause(),e=z(e,s),e.unshift(s)},remove:s=>{var a,c;e=z(e,s),(c=(a=e[0])==null?void 0:a.resume)==null||c.call(a)}}},ge=(e,t=!1)=>{const o=document.activeElement;for(const s of e)if(l(s,t),document.activeElement!==o)return},G=Pe(),Le=()=>P.value>U.value,F=()=>{R.value="pointer",P.value=window.performance.now()},Q=()=>{R.value="keyboard",P.value=window.performance.now()},Se=()=>(N(()=>{b===0&&(document.addEventListener("mousedown",F),document.addEventListener("touchstart",F),document.addEventListener("keydown",Q)),b++}),I(()=>{b--,b<=0&&(document.removeEventListener("mousedown",F),document.removeEventListener("touchstart",F),document.removeEventListener("keydown",Q))}),{focusReason:R,lastUserFocusTimestamp:P,lastAutomatedFocusTimestamp:U}),y=e=>new CustomEvent(Te,{...me,detail:e});let p=[];const Z=e=>{e.code===ne.esc&&p.forEach(t=>t(e))},he=e=>{N(()=>{p.length===0&&document.addEventListener("keydown",Z),j&&p.push(e)}),I(()=>{p=p.filter(t=>t!==e),p.length===0&&j&&document.removeEventListener("keydown",Z)})},we=ee({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[X,Y,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:t}){const o=_();let s,a;const{focusReason:c}=Se();he(n=>{e.trapped&&!v.paused&&t("release-requested",n)});const v={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},E=n=>{if(!e.loop&&!e.trapped||v.paused)return;const{code:r,altKey:u,ctrlKey:i,metaKey:d,currentTarget:$,shiftKey:H}=n,{loop:V}=e,oe=r===ne.tab&&!u&&!i&&!d,T=document.activeElement;if(oe&&T){const S=$,[h,w]=ye(S);if(h&&w){if(!H&&T===w){const f=y({focusReason:c.value});t("focusout-prevented",f),f.defaultPrevented||(n.preventDefault(),V&&l(h,!0))}else if(H&&[h,S].includes(T)){const f=y({focusReason:c.value});t("focusout-prevented",f),f.defaultPrevented||(n.preventDefault(),V&&l(w,!0))}}else if(T===S){const f=y({focusReason:c.value});t("focusout-prevented",f),f.defaultPrevented||n.preventDefault()}}};ce(be,{focusTrapRef:o,onKeydown:E}),A(()=>e.focusTrapEl,n=>{n&&(o.value=n)},{immediate:!0}),A([o],([n],[r])=>{n&&(n.addEventListener("keydown",E),n.addEventListener("focusin",g),n.addEventListener("focusout",L)),r&&(r.removeEventListener("keydown",E),r.removeEventListener("focusin",g),r.removeEventListener("focusout",L))});const K=n=>{t(X,n)},x=n=>t(Y,n),g=n=>{const r=m(o);if(!r)return;const u=n.target,i=n.relatedTarget,d=u&&r.contains(u);e.trapped||i&&r.contains(i)||(s=i),d&&t("focusin",n),!v.paused&&e.trapped&&(d?a=u:l(a,!0))},L=n=>{const r=m(o);if(!(v.paused||!r))if(e.trapped){const u=n.relatedTarget;!re(u)&&!r.contains(u)&&setTimeout(()=>{if(!v.paused&&e.trapped){const i=y({focusReason:c.value});t("focusout-prevented",i),i.defaultPrevented||l(a,!0)}},0)}else{const u=n.target;u&&r.contains(u)||t("focusout",n)}};async function D(){await M();const n=m(o);if(n){G.push(v);const r=n.contains(document.activeElement)?s:document.activeElement;if(s=r,!n.contains(r)){const i=new Event(C,W);n.addEventListener(C,K),n.dispatchEvent(i),i.defaultPrevented||M(()=>{let d=e.focusStartEl;ae(d)||(l(d),document.activeElement!==d&&(d="first")),d==="first"&&ge(se(n),!0),(document.activeElement===r||d==="container")&&l(n)})}}}function B(){const n=m(o);if(n){n.removeEventListener(C,K);const r=new CustomEvent(O,{...W,detail:{focusReason:c.value}});n.addEventListener(O,x),n.dispatchEvent(r),!r.defaultPrevented&&(c.value=="keyboard"||!Le()||n.contains(document.activeElement))&&l(s??document.body),n.removeEventListener(O,x),G.remove(v)}}return N(()=>{e.trapped&&D(),A(()=>e.trapped,n=>{n?D():B()})}),I(()=>{e.trapped&&B(),o.value&&(o.value.removeEventListener("keydown",E),o.value.removeEventListener("focusin",g),o.value.removeEventListener("focusout",L),o.value=void 0)}),{onKeydown:E}}});function Ae(e,t,o,s,a,c){return k(e.$slots,"default",{handleKeydown:e.onKeydown})}var Ve=te(we,[["render",Ae],["__file","focus-trap.vue"]]);const Ce=fe({to:{type:le([String,Object]),required:!0},disabled:Boolean}),Oe=ee({__name:"teleport",props:Ce,setup(e){return(t,o)=>t.disabled?k(t.$slots,"default",{key:0}):(ie(),ue(de,{key:1,to:t.to},[k(t.$slots,"default")],8,["to"]))}});var ke=te(Oe,[["__file","teleport.vue"]]);const qe=ve(ke);export{Ve as E,be as F,qe as a,Be as b,Ee as c,pe as d,l as e,He as f,$e as g,De as i,Ce as t};
