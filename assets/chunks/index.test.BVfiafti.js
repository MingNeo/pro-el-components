import{m as P}from"./vue-test-utils.esm-bundler.BNPP31t0.js";import"./base.Dwgz6jSd.js";/* empty css                          *//* empty css              */import{E as s}from"./el-input.DQ30HcuH.js";import"./el-button.k3Ms4Xdh.js";import"./el-scrollbar.HZhNcw01.js";import"./el-popper.CZJRST1P.js";/* empty css                     *//* empty css                       */import"./el-tag.BDcJ6G_i.js";import{a as w}from"./el-select.D9tonctu.js";import"./el-tooltip.l0sNRNKZ.js";/* empty css                  */import{a as E}from"./el-checkbox.B0vmRW9S.js";import{_ as A}from"./index.vue_vue_type_script_setup_true_lang.Cm45yPGm.js";import{d as W,b as k,i as a,g as o}from"./vi.JYQecGiw.CsLlcVZs.js";import{a as f,d as h,e as y,f as S,E as v,b as I,c as T}from"./index.vue_vue_type_script_setup_true_lang.CgsMylzL.js";import{a as x,E as q}from"./index.DbWT0aQr.js";import{a as C}from"./index.RVi9Xofb.js";import{E as V}from"./index.CaFP4xeD.js";import{P as p,a8 as H,d as L,p as g,q as R,ak as B}from"./framework.igcgEEdr.js";import"./index.D353ODTN.js";import"./index.mDR6Kexr.js";import"./isSymbol.C7jn4vLP.js";import"./isObject.C3e4t58V.js";import"./icon.C3T6eoYR.js";import"./types.DNi1ojkw.js";import"./index.BQOwn3WU.js";import"./typescript.Bp3YSIOJ.js";import"./index.BI4o4ewH.js";import"./arrayPush.CXZMwWBu.js";import"./event.BB_Ol6Sd.js";import"./index.8K3Om35h.js";import"./use-form-item.Daeosa58.js";import"./use-form-common-props.BIymRJo1.js";import"./index.BndPLsPe.js";import"./error.Cq9Fpw4b.js";import"./index.DBJOzW_o.js";import"./use-global-config.CrFx92Tt.js";import"./index.CRCbWsfX.js";import"./index.BjB1lFfg.js";import"./index.Brw29sq5.js";import"./aria.9SHySdGF.js";import"./castArray.nshRf-Q-.js";import"./isEqual.DkZuJHVE.js";import"./scroll.DxJqq-ED.js";import"./debounce.BwFge-ki.js";import"./FieldWrapper.vue_vue_type_script_setup_true_lang.BQIeAx6E.js";/* empty css               */import"./constants.0YSy3Igo.js";import"./helper.DcuHLwUz.js";import"./dayjs.min.Ba62AOpW.js";import"./commonjsHelpers.BosuxZz1.js";import"./useFieldWatch.CAezyHFE.js";import"./Wrapper.vue_vue_type_script_setup_true_lang.CPkOFA02.js";/* empty css               *//* empty css              *//* empty css                    *//* empty css                   *//* empty css                          *//* empty css                 *//* empty css                   *//* empty css              *//* empty css                *//* empty css              *//* empty css              *//* empty css                   *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./el-table-column.BBssXNKa.js";/* empty css                                                      *//* empty css              *//* empty css                    *//* empty css              */import"./vite-browser-external_commonjs-proxy.BC9WSf1a.js";/* empty css                        */import"./index.vue_vue_type_script_setup_true_lang.BT-Ywz00.js";import"./index.SQqbOIf2.js";import"./cloneDeep.DdLfN6Fq.js";import"./baseClone.p2iRr-IY.js";import"./initCloneObject.BLfUkf_9.js";import"./index.BsakEZKL.js";import"./refs.n9wIXTtR.js";import"./index.vue_vue_type_script_setup_true_lang.32sqq2C1.js";import"./index.vue_vue_type_script_setup_true_lang.BVOXUtzn.js";import"./index.vue_vue_type_script_setup_true_lang.D98OUrhU.js";import"./index.vue_vue_type_script_setup_true_lang.CdsKtYT4.js";import"./index.CemNZkGQ.js";import"./baseUniq.CpJglj-j.js";function r(d={}){const l=L({props:{fields:Array,modelValue:Object},setup(t,{emit:i,attrs:n,expose:c}){const m=g({...t.modelValue||{}}),b=g();R(()=>t.modelValue,u=>{m.value={...u||{}}},{deep:!0,immediate:!0});const F=u=>{m.value=u,i("update:modelValue",u)};return c({formRef:b}),()=>B(q,{model:m.value,ref:b},{default:()=>B(A,{fields:t.fields||[],modelValue:m.value,"onUpdate:modelValue":F,...n})})}}),e=d.props||{};return P(l,{...d,props:e})}W("proFormFields组件",()=>{let d;k(()=>{d=[{prop:"username",label:"用户名",type:"input",required:!0},{prop:"gender",label:"性别",type:"select",options:[{label:"男",value:"male"},{label:"女",value:"female"}]}]}),a("应该正确渲染表单项",()=>{const l=r({props:{fields:d,modelValue:{}}});o(l.findAllComponents(s)).toHaveLength(1),o(l.findAllComponents(w)).toHaveLength(1)}),a("应该正确处理表单值的更新",async()=>{const l=r({props:{fields:[{prop:"username",label:"用户名",type:"input",required:!0}],modelValue:{username:""}}});await l.findComponent(s).setValue("测试用户"),o(l.emitted("update:modelValue")).toBeTruthy(),o(l.emitted("update:modelValue")[0][0]).toEqual({username:"测试用户"})}),a("应该正确处理viewMode模式",async()=>{const l=r({props:{fields:d,modelValue:{username:"测试用户",gender:"male"},viewMode:!0}});o(l.findComponent(s).exists()).toBe(!1),o(l.findComponent(w).exists()).toBe(!1),await p();const e=l.findAll(".el-form-item__content");o(e[0].text()).toBe("测试用户"),o(e[1].text()).toBe("男")}),a("应该正确处理表单项的显示/隐藏逻辑",async()=>{const e=r({props:{fields:[{prop:"type",label:"类型",type:"select",options:[{label:"类型A",value:"A"},{label:"类型B",value:"B"}]},{prop:"extraField",label:"额外字段",type:"input",show:t=>t.type==="A"}],modelValue:{type:"B"}}});o(e.findAllComponents(s)).toHaveLength(0),await e.setProps({modelValue:{type:"A"}}),o(e.findAllComponents(s)).toHaveLength(1)}),a("应该正确处理日期类型的字段",async()=>{const e=r({props:{fields:[{prop:"birthday",label:"生日",type:"datePicker"}],modelValue:{}}});o(e.findComponent(f).exists()).toBe(!0)}),a("应该正确处理数字输入类型",async()=>{const e=r({props:{fields:[{prop:"age",label:"年龄",type:"number",min:0,max:120}],modelValue:{age:25}}}),t=e.findComponent(h);o(t.exists()).toBe(!0),await t.setValue(30),o(e.emitted("update:modelValue")[0][0]).toEqual({age:30})}),a("应该正确处理自定义验证规则",async()=>{const t=r({props:{fields:[{prop:"email",label:"邮箱",type:"input",required:!0,rules:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入有效的邮箱地址"}]}],modelValue:{}}}).findComponent(x);o(t.exists()).toBe(!0),o(t.vm.rules).toBeTruthy()}),a("应该正确处理禁用状态",()=>{const t=r({props:{fields:[{prop:"username",label:"用户名",type:"input",fieldProps:{disabled:!0}}],modelValue:{username:"测试用户"}}}).findComponent(s);o(t.vm.disabled).toBe(!0)}),a("应该正确处理多选框组",async()=>{const t=r({props:{fields:[{prop:"hobbies",label:"兴趣爱好",type:"checkbox",options:[{label:"阅读",value:"reading"},{label:"运动",value:"sports"},{label:"音乐",value:"music"}]}],modelValue:{hobbies:["reading"]}}}).findComponent(E);o(t.exists()).toBe(!0)}),a("应该正确处理自定义Field",()=>{const l=H({template:'<div class="custom-field">自定义内容</div>'}),e=r({props:{fields:[{prop:"custom",label:"自定义字段",type:"component",component:l}],modelValue:{}}});o(e.find(".custom-field").exists()).toBe(!0),o(e.find(".custom-field").text()).toBe("自定义内容")}),a("应该正确处理表单验证",async()=>{const l=r({props:{fields:d,modelValue:{}}});await p();try{await l.vm.formRef.validate(),o(!0).toBe(!1)}catch(e){o(e).toBeTruthy()}await l.setProps({modelValue:{username:"测试用户"}}),await p(),await l.vm.formRef.validate()}),a("应该正确处理值格式化",async()=>{var i;const e=r({props:{fields:[{prop:"price",label:"价格",type:"input",formatChangedValue:n=>Number(n)}],modelValue:{price:100}}});await e.findComponent(s).setValue("200"),o((i=e.emitted("update:modelValue")[0])==null?void 0:i[0].price).toBe(200)}),a("应该正确处理栅格布局",()=>{const e=r({props:{fields:d,modelValue:{},column:2}}).findAll(".el-col-12");o(e.length).toBeGreaterThan(0)}),a("应该正确渲染text类型字段",()=>{const e=r({props:{fields:[{prop:"description",label:"描述",type:"text"}],modelValue:{description:"这是一段描述文本"}}});o(e.text()).toContain("这是一段描述文本")}),a("应该正确处理textarea类型字段",async()=>{const e=r({props:{fields:[{prop:"content",label:"内容",type:"textarea"}],modelValue:{content:""}}}),t=e.findComponent(s);o(t.exists()).toBe(!0),o(t.vm.type).toBe("textarea"),await t.setValue("这是多行文本内容"),o(e.emitted("update:modelValue")[0][0]).toEqual({content:"这是多行文本内容"})}),a("应该正确处理radio类型字段",async()=>{const t=r({props:{fields:[{prop:"status",label:"状态",type:"radio",options:[{label:"启用",value:"enabled"},{label:"禁用",value:"disabled"}]}],modelValue:{status:"enabled"}}}).findComponent(C);o(t.exists()).toBe(!0)}),a("应该正确渲染radio类型在viewMode下的显示",async()=>{const e=r({props:{fields:[{prop:"status",label:"状态",type:"radio",options:[{label:"启用",value:"enabled"},{label:"禁用",value:"disabled"}]}],modelValue:{status:"enabled"},viewMode:!0}});await p(),o(e.findComponent(C).exists()).toBe(!1);const t=e.findAll(".el-form-item__content");o(t[0].text()).toBe("启用")}),a("应该正确处理rate类型字段",()=>{const t=r({props:{fields:[{prop:"rating",label:"评分",type:"rate"}],modelValue:{rating:3}}}).findComponent(y);o(t.exists()).toBe(!0),o(t.vm.modelValue).toBe(3)}),a("应该正确处理slider类型字段",async()=>{const t=r({props:{fields:[{prop:"volume",label:"音量",type:"slider",fieldProps:{min:0,max:100}}],modelValue:{volume:50}}}).findComponent(S);o(t.exists()).toBe(!0)}),a("应该正确处理switch类型字段",async()=>{const t=r({props:{fields:[{prop:"enabled",label:"是否启用",type:"switch"}],modelValue:{enabled:!1}}}).findComponent(V);o(t.exists()).toBe(!0),o(t.vm.modelValue).toBe(!1)}),a("应该正确处理timePicker类型字段",()=>{const t=r({props:{fields:[{prop:"time",label:"时间",type:"timePicker"}],modelValue:{}}}).findComponent(v);o(t.exists()).toBe(!0)}),a("应该正确处理rangePicker类型字段",()=>{const t=r({props:{fields:[{prop:"dateRange",label:"日期范围",type:"rangePicker"}],modelValue:{}}}).findComponent(f);o(t.exists()).toBe(!0),o(t.vm.type).toBe("daterange")}),a("应该正确处理cascader类型字段",()=>{const e=r({props:{fields:[{prop:"area",label:"地区",type:"cascader",fieldProps:{options:[{value:"guangdong",label:"广东",children:[{value:"guangzhou",label:"广州"},{value:"shenzhen",label:"深圳"}]}]}}],modelValue:{}}});o(e.html()).toContain("el-cascader")}),a("应该正确处理treeSelect类型字段",()=>{const t=r({props:{fields:[{prop:"department",label:"部门",type:"treeSelect",fieldProps:{data:[{value:"1",label:"技术部",children:[{value:"1-1",label:"前端组"},{value:"1-2",label:"后端组"}]}]}}],modelValue:{}}}).findComponent(I);o(t.exists()).toBe(!0)}),a("应该正确处理colorPicker类型字段",async()=>{const t=r({props:{fields:[{prop:"color",label:"颜色",type:"colorPicker"}],modelValue:{color:"#409eff"}}}).findComponent(T);o(t.exists()).toBe(!0)}),a("应该正确处理upload类型字段",()=>{const e=r({props:{fields:[{prop:"files",label:"文件上传",type:"upload"}],modelValue:{files:[]}}});o(e.html()).toContain("pro-upload")}),a("应该正确处理text类型字段的customRender",()=>{const e=r({props:{fields:[{prop:"price",label:"价格",type:"text",customRender:t=>`¥${t}`}],modelValue:{price:100}}});o(e.text()).toContain("¥100")}),a("应该正确处理所有字段类型在viewMode下的显示",async()=>{const e=r({props:{fields:[{prop:"input",label:"输入框",type:"input"},{prop:"textarea",label:"多行文本",type:"textarea"},{prop:"number",label:"数字",type:"number"},{prop:"date",label:"日期",type:"datePicker"},{prop:"time",label:"时间",type:"timePicker"},{prop:"range",label:"日期范围",type:"rangePicker"}],modelValue:{input:"文本内容",textarea:"多行文本内容",number:100,date:"2024-01-01",time:"12:00:00",range:["2024-01-01","2024-01-31"]},viewMode:!0}});await p(),o(e.findComponent(s).exists()).toBe(!1),o(e.findComponent(h).exists()).toBe(!1),o(e.findComponent(f).exists()).toBe(!1),o(e.findComponent(v).exists()).toBe(!1)}),a("应该正确处理不同类型字段的禁用状态",()=>{const e=r({props:{fields:[{prop:"rate",label:"评分",type:"rate",fieldProps:{disabled:!0}},{prop:"switch",label:"开关",type:"switch",fieldProps:{disabled:!0}}],modelValue:{rate:3,switch:!0}}}),t=e.findComponent(y),i=e.findComponent(V);o(t.vm.disabled).toBe(!0),o(i.vm.disabled).toBe(!0)}),a("应该正确渲染labelExtra和labelTip",()=>{const e=r({props:{fields:[{prop:"username",label:"用户名",type:"input",labelExtra:"(必填)",labelTip:"请输入6-20位字符"}],modelValue:{}}});o(e.text()).toContain("用户名"),o(e.text()).toContain("(必填)"),o(e.html()).toContain("label-tip-icon")}),a("应该正确处理字段的on事件",async()=>{let l=0;await r({props:{fields:[{prop:"username",label:"用户名",type:"input",onChange:()=>{l++}}],modelValue:{username:""}}}).findComponent(s).vm.$emit("update:modelValue","测试"),o(l).toBe(1)}),a("应该正确处理requiredOnlyStyle属性",()=>{const t=r({props:{fields:[{prop:"username",label:"用户名",type:"input",required:!0,requiredOnlyStyle:!0}],modelValue:{}}}).findComponent(x);o(t.exists()).toBe(!0),o(t.vm.rules).toBeTruthy()}),a("应该正确处理字段单独的viewMode设置",async()=>{const e=r({props:{fields:[{prop:"username",label:"用户名",type:"input",viewMode:!0},{prop:"password",label:"密码",type:"input",viewMode:!1}],modelValue:{username:"张三",password:"123456"},viewMode:!1}});await p();const t=e.findAll(".el-form-item__content");o(t[0].text()).toBe("张三"),o(e.findAllComponents(s)).toHaveLength(1)}),a("应该正确处理watch handler方式的字段联动 - 动态改变字段属性",async()=>{const e=r({props:{fields:[{prop:"type",label:"类型",type:"select",options:[{label:"个人",value:"personal"},{label:"企业",value:"company"}]},{prop:"name",label:"名称",type:"input",watch:{field:"type",handler:t=>{if(t==="personal")return{label:"姓名",fieldProps:{placeholder:"请输入姓名"}};if(t==="company")return{label:"企业名称",fieldProps:{placeholder:"请输入企业名称"}}}}}],modelValue:{type:"personal"}}});await p(),await p(),o(e.text()).toContain("姓名"),await e.setProps({modelValue:{type:"company"}}),await p(),await p(),o(e.text()).toContain("企业名称")}),a("应该正确处理watch conditions方式的字段联动",async()=>{const e=r({props:{fields:[{prop:"age",label:"年龄",type:"number"},{prop:"idCard",label:"身份证号",type:"input",watch:{field:"age",conditions:[{when:n=>n<18,update:{fieldProps:{disabled:!0,placeholder:"未成年无需填写"}}},{when:n=>n>=18,update:{fieldProps:{disabled:!1,placeholder:"请输入身份证号"}}}]}}],modelValue:{age:15}}});await p(),await p();let t=e.findAllComponents(s),i=t[t.length-1];o(i.vm.disabled).toBe(!0),await e.setProps({modelValue:{age:20}}),await p(),t=e.findAllComponents(s),i=t[t.length-1],o(i.vm.disabled).toBe(!1)}),a("应该正确处理多个字段的联动",async()=>{const e=r({props:{fields:[{prop:"country",label:"国家",type:"select",options:[{label:"中国",value:"china"},{label:"美国",value:"usa"}]},{prop:"province",label:"省份",type:"select",options:[{label:"广东",value:"guangdong"},{label:"北京",value:"beijing"}],watch:{field:"country",handler:t=>t==="china"?{fieldProps:{disabled:!1,placeholder:"请选择省份"}}:{fieldProps:{disabled:!0,placeholder:"请先选择中国"}}}},{prop:"city",label:"城市",type:"select",options:[{label:"广州",value:"guangzhou"},{label:"深圳",value:"shenzhen"}],watch:{field:"province",handler:t=>t?{fieldProps:{disabled:!1}}:{fieldProps:{disabled:!0}}}}],modelValue:{country:"usa"}}});await p(),await p(),o(e.html()).toContain("请先选择中国")}),a("应该正确处理watch监听多个字段",async()=>{const e=r({props:{fields:[{prop:"hasChildren",label:"是否有子女",type:"switch"},{prop:"familyInfo",label:"家庭信息",type:"textarea",watch:{field:"hasChildren",handler:n=>n?{fieldProps:{disabled:!1,placeholder:"请填写家庭信息"}}:{fieldProps:{disabled:!0,placeholder:"无子女无需填写"}}}}],modelValue:{hasChildren:!1}}});await p(),await p();const t=e.findComponent(s);o(t.vm.disabled).toBe(!0),await e.setProps({modelValue:{hasChildren:!0}}),await p();const i=e.findComponent(s);o(i.vm.disabled).toBe(!1)}),a("应该正确处理watch handler返回void的情况",async()=>{let l=!1;r({props:{fields:[{prop:"status",label:"状态",type:"select",options:[{label:"启用",value:"enabled"},{label:"禁用",value:"disabled"}]},{prop:"note",label:"备注",type:"input",watch:{field:"status",handler:t=>{l=!0}}}],modelValue:{status:"enabled"}}}),await p(),await p(),o(l).toBe(!0)}),a("应该正确处理watch与show属性的组合",async()=>{const e=r({props:{fields:[{prop:"needExtraInfo",label:"需要额外信息",type:"switch"},{prop:"extraType",label:"信息类型",type:"select",options:[{label:"类型A",value:"A"},{label:"类型B",value:"B"}],show:t=>t.needExtraInfo},{prop:"extraDetail",label:"详细信息",type:"textarea",show:t=>t.needExtraInfo,watch:{field:"extraType",handler:t=>{if(t==="A")return{label:"类型A详细信息",fieldProps:{placeholder:"请输入类型A的详细信息"}};if(t==="B")return{label:"类型B详细信息",fieldProps:{placeholder:"请输入类型B的详细信息"}}}}}],modelValue:{needExtraInfo:!1}}});await p(),o(e.findAllComponents(s)).toHaveLength(0),await e.setProps({modelValue:{needExtraInfo:!0,extraType:"A"}}),await p(),await p(),o(e.text()).toContain("类型A详细信息"),await e.setProps({modelValue:{needExtraInfo:!0,extraType:"B"}}),await p(),await p(),o(e.text()).toContain("类型B详细信息")}),a("应该正确处理watch conditions的匹配优先级",async()=>{const e=r({props:{fields:[{prop:"score",label:"分数",type:"number"},{prop:"level",label:"等级",type:"input",watch:{field:"score",conditions:[{when:n=>n>=90,update:{fieldProps:{placeholder:"优秀"}}},{when:n=>n>=80,update:{fieldProps:{placeholder:"良好"}}},{when:n=>n>=60,update:{fieldProps:{placeholder:"及格"}}},{when:()=>!0,update:{fieldProps:{placeholder:"不及格"}}}]}}],modelValue:{score:95}}});await p(),await p();let t=e.findAllComponents(s),i=t[t.length-1];o(i.vm.placeholder).toBe("优秀"),await e.setProps({modelValue:{score:85}}),await p(),t=e.findAllComponents(s),i=t[t.length-1],o(i.vm.placeholder).toBe("良好"),await e.setProps({modelValue:{score:65}}),await p(),o(e.html()).toContain("及格"),await e.setProps({modelValue:{score:50}}),await p(),o(e.html()).toContain("不及格")}),a("应该正确处理watch联动更新字段选项",async()=>{const e=r({props:{fields:[{prop:"category",label:"分类",type:"select",options:[{label:"水果",value:"fruit"},{label:"蔬菜",value:"vegetable"}]},{prop:"item",label:"具体项目",type:"select",options:[],watch:{field:"category",handler:m=>m==="fruit"?{options:[{label:"苹果",value:"apple"},{label:"香蕉",value:"banana"},{label:"橙子",value:"orange"}]}:m==="vegetable"?{options:[{label:"白菜",value:"cabbage"},{label:"萝卜",value:"radish"},{label:"土豆",value:"potato"}]}:{options:[]}}}],modelValue:{category:"fruit"}}});await p(),await p();const t=e.findAllComponents({name:"ProSelect"});o(t).toHaveLength(2);const i=t[1];o(i.vm.options).toHaveLength(3),o(i.vm.options[0].label).toBe("苹果"),await e.setProps({modelValue:{category:"vegetable"}}),await p();const c=e.findAllComponents({name:"ProSelect"})[1];o(c.vm.options).toHaveLength(3),o(c.vm.options[0].label).toBe("白菜")})});
