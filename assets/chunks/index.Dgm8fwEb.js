import{u as D}from"./index.DT7TJvLG.js";import{d as te,ak as ye,p as k,aW as Pe,D as Ae,h as v,q as me,v as Ce,b as ve,o as y,w as p,G as i,T as Be,j as b,N as he,n as m,k as e,e as C,c as S,r as x,Z as Me,F as ae,a as Ve,t as Ee,H as De,B as Fe,a2 as Ye,a3 as Xe,P as Le,aV as He,a6 as je,K as be,a1 as ke,aj as Ie,ap as Ke}from"./framework.CCndWvNN.js";import{E as We,a as qe}from"./index.BESs4zff.js";import{u as Ze,E as $}from"./index.dVC2hAAQ.js";import{y as Ge,z as Ue,b as Je,h as Qe,A as ea,B as aa,C as ta,D as sa,E as oa}from"./index.l2C8AFQu.js";import{a as ze,d as q,_ as _e,c as Se,w as Ne,f as na}from"./base.D1hT_OMg.js";import{m as Oe}from"./typescript.Bp3YSIOJ.js";import{a as pe,i as ra}from"./types.BG7Bq31m.js";import{u as Te}from"./index.CQNcN25s.js";import{E as V}from"./aria.9SHySdGF.js";import{k as la}from"./use-global-config.Cy85fLye.js";import{d as ia}from"./debounce.BwFge-ki.js";import{i as ua}from"./isObject.C3e4t58V.js";import{i as ca}from"./el-image-viewer.Dja78u7m.js";import{u as da}from"./index.BSzUxMWT.js";import{g as fa}from"./scroll.I75wR7Fj.js";import{a as W,u as ma}from"./index.B1pLMPru.js";var va="Expected a function";function fe(u,B,c){var d=!0,o=!0;if(typeof u!="function")throw new TypeError(va);return ua(c)&&(d="leading"in c?!!c.leading:d,o="trailing"in c?!!c.trailing:o),ia(u,B,{leading:d,maxWait:B,trailing:o})}const pa=ze({urlList:{type:q(Array),default:()=>Oe([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:q(String)}}),ga={close:()=>!0,switch:u=>pe(u),rotate:u=>pe(u)},wa=te({name:"ElImageViewer"}),ya=te({...wa,props:pa,emits:ga,setup(u,{expose:B,emit:c}){var d;const o=u,g={CONTAIN:{name:"contain",icon:ye(Ue)},ORIGINAL:{name:"original",icon:ye(Ge)}};let F,Y="";const{t:se}=Te(),s=Se("image-viewer"),{nextZIndex:R}=Ze(),E=k(),M=k([]),P=Pe(),f=k(!0),w=k(o.initialIndex),N=Ae(g.CONTAIN),r=k({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),oe=k((d=o.zIndex)!=null?d:R()),X=v(()=>{const{urlList:a}=o;return a.length<=1}),Z=v(()=>w.value===0),H=v(()=>w.value===o.urlList.length-1),j=v(()=>o.urlList[w.value]),ne=v(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!o.infinite&&Z.value)]),re=v(()=>[s.e("btn"),s.e("next"),s.is("disabled",!o.infinite&&H.value)]),G=v(()=>{const{scale:a,deg:l,offsetX:n,offsetY:I,enableTransition:z}=r.value;let _=n/a,T=I/a;const K=l*Math.PI/180,ge=Math.cos(K),we=Math.sin(K);_=_*ge+T*we,T=T*ge-n/a*we;const de={transform:`scale(${a}) rotate(${l}deg) translate(${_}px, ${T}px)`,transition:z?"transform .3s":""};return N.value.name===g.CONTAIN.name&&(de.maxWidth=de.maxHeight="100%"),de}),U=v(()=>`${w.value+1} / ${o.urlList.length}`);function A(){Q(),F==null||F(),document.body.style.overflow=Y,c("close")}function J(){const a=fe(n=>{switch(n.code){case V.esc:o.closeOnPressEscape&&A();break;case V.space:L();break;case V.left:ue();break;case V.up:O("zoomIn");break;case V.right:ce();break;case V.down:O("zoomOut");break}}),l=fe(n=>{const I=n.deltaY||n.deltaX;O(I<0?"zoomIn":"zoomOut",{zoomRate:o.zoomRate,enableTransition:!1})});P.run(()=>{D(document,"keydown",a),D(document,"wheel",l)})}function Q(){P.stop()}function le(){f.value=!1}function ie(a){f.value=!1,a.target.alt=se("el.image.error")}function t(a){if(f.value||a.button!==0||!E.value)return;r.value.enableTransition=!1;const{offsetX:l,offsetY:n}=r.value,I=a.pageX,z=a.pageY,_=fe(K=>{r.value={...r.value,offsetX:l+K.pageX-I,offsetY:n+K.pageY-z}}),T=D(document,"mousemove",_);D(document,"mouseup",()=>{T()}),a.preventDefault()}function h(){r.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function L(){if(f.value)return;const a=la(g),l=Object.values(g),n=N.value.name,z=(l.findIndex(_=>_.name===n)+1)%a.length;N.value=g[a[z]],h()}function ee(a){const l=o.urlList.length;w.value=(a+l)%l}function ue(){Z.value&&!o.infinite||ee(w.value-1)}function ce(){H.value&&!o.infinite||ee(w.value+1)}function O(a,l={}){if(f.value)return;const{minScale:n,maxScale:I}=o,{zoomRate:z,rotateDeg:_,enableTransition:T}={zoomRate:o.zoomRate,rotateDeg:90,enableTransition:!0,...l};switch(a){case"zoomOut":r.value.scale>n&&(r.value.scale=Number.parseFloat((r.value.scale/z).toFixed(3)));break;case"zoomIn":r.value.scale<I&&(r.value.scale=Number.parseFloat((r.value.scale*z).toFixed(3)));break;case"clockwise":r.value.deg+=_,c("rotate",r.value.deg);break;case"anticlockwise":r.value.deg-=_,c("rotate",r.value.deg);break}r.value.enableTransition=T}function $e(a){var l;((l=a.detail)==null?void 0:l.focusReason)==="pointer"&&a.preventDefault()}function xe(){o.closeOnPressEscape&&A()}function Re(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}return me(j,()=>{Le(()=>{const a=M.value[0];a!=null&&a.complete||(f.value=!0)})}),me(w,a=>{h(),c("switch",a)}),Ce(()=>{J(),F=D("wheel",Re,{passive:!1}),Y=document.body.style.overflow,document.body.style.overflow="hidden"}),B({setActiveItem:ee}),(a,l)=>(y(),ve(e(qe),{to:"body",disabled:!a.teleported},{default:p(()=>[i(Be,{name:"viewer-fade",appear:""},{default:p(()=>[b("div",{ref_key:"wrapper",ref:E,tabindex:-1,class:m(e(s).e("wrapper")),style:he({zIndex:oe.value})},[i(e(We),{loop:"",trapped:"","focus-trap-el":E.value,"focus-start-el":"container",onFocusoutPrevented:$e,onReleaseRequested:xe},{default:p(()=>[b("div",{class:m(e(s).e("mask")),onClick:Me(n=>a.hideOnClickModal&&A(),["self"])},null,10,["onClick"]),C(" CLOSE "),b("span",{class:m([e(s).e("btn"),e(s).e("close")]),onClick:A},[i(e($),null,{default:p(()=>[i(e(Je))]),_:1})],2),C(" ARROW "),e(X)?C("v-if",!0):(y(),S(ae,{key:0},[b("span",{class:m(e(ne)),onClick:ue},[i(e($),null,{default:p(()=>[i(e(Qe))]),_:1})],2),b("span",{class:m(e(re)),onClick:ce},[i(e($),null,{default:p(()=>[i(e(ea))]),_:1})],2)],64)),a.$slots.progress||a.showProgress?(y(),S("div",{key:1,class:m([e(s).e("btn"),e(s).e("progress")])},[x(a.$slots,"progress",{activeIndex:w.value,total:a.urlList.length},()=>[Ve(Ee(e(U)),1)])],2)):C("v-if",!0),C(" ACTIONS "),b("div",{class:m([e(s).e("btn"),e(s).e("actions")])},[b("div",{class:m(e(s).e("actions__inner"))},[x(a.$slots,"toolbar",{actions:O,prev:ue,next:ce,reset:L,activeIndex:w.value,setActiveItem:ee},()=>[i(e($),{onClick:n=>O("zoomOut")},{default:p(()=>[i(e(aa))]),_:1},8,["onClick"]),i(e($),{onClick:n=>O("zoomIn")},{default:p(()=>[i(e(ta))]),_:1},8,["onClick"]),b("i",{class:m(e(s).e("actions__divider"))},null,2),i(e($),{onClick:L},{default:p(()=>[(y(),ve(De(e(N).icon)))]),_:1}),b("i",{class:m(e(s).e("actions__divider"))},null,2),i(e($),{onClick:n=>O("anticlockwise")},{default:p(()=>[i(e(sa))]),_:1},8,["onClick"]),i(e($),{onClick:n=>O("clockwise")},{default:p(()=>[i(e(oa))]),_:1},8,["onClick"])])],2)],2),C(" CANVAS "),b("div",{class:m(e(s).e("canvas"))},[(y(!0),S(ae,null,Fe(a.urlList,(n,I)=>Ye((y(),S("img",{ref_for:!0,ref:z=>M.value[I]=z,key:n,src:n,style:he(e(G)),class:m(e(s).e("img")),crossorigin:a.crossorigin,onLoad:le,onError:ie,onMousedown:t},null,46,["src","crossorigin"])),[[Xe,I===w.value]])),128))],2),x(a.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ha=_e(ya,[["__file","image-viewer.vue"]]);const ba=Ne(ha),ka=ze({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:q([String,Object])},previewSrcList:{type:q(Array),default:()=>Oe([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:q(String)}}),Ia={load:u=>u instanceof Event,error:u=>u instanceof Event,switch:u=>pe(u),close:()=>!0,show:()=>!0},Ca=te({name:"ElImage",inheritAttrs:!1}),Ea=te({...Ca,props:ka,emits:Ia,setup(u,{expose:B,emit:c}){const d=u,{t:o}=Te(),g=Se("image"),F=He(),Y=v(()=>na(Object.entries(F).filter(([t])=>/^(data-|on[A-Z])/i.test(t)||["id","style"].includes(t)))),se=da({excludeListeners:!0,excludeKeys:v(()=>Object.keys(Y.value))}),s=k(),R=k(!1),E=k(!0),M=k(!1),P=k(),f=k(),w=W&&"loading"in HTMLImageElement.prototype;let N;const r=v(()=>[g.e("inner"),X.value&&g.e("preview"),E.value&&g.is("loading")]),oe=v(()=>{const{fit:t}=d;return W&&t?{objectFit:t}:{}}),X=v(()=>{const{previewSrcList:t}=d;return je(t)&&t.length>0}),Z=v(()=>{const{previewSrcList:t,initialIndex:h}=d;let L=h;return h>t.length-1&&(L=0),L}),H=v(()=>d.loading==="eager"?!1:!w&&d.loading==="lazy"||d.lazy),j=()=>{W&&(E.value=!0,R.value=!1,s.value=d.src)};function ne(t){E.value=!1,R.value=!1,c("load",t)}function re(t){E.value=!1,R.value=!0,c("error",t)}function G(){ca(P.value,f.value)&&(j(),J())}const U=ma(G,200,!0);async function A(){var t;if(!W)return;await Le();const{scrollContainer:h}=d;ra(h)?f.value=h:Ke(h)&&h!==""?f.value=(t=document.querySelector(h))!=null?t:void 0:P.value&&(f.value=fa(P.value)),f.value&&(N=D(f,"scroll",U),setTimeout(()=>G(),100))}function J(){!W||!f.value||!U||(N==null||N(),f.value=void 0)}function Q(){X.value&&(M.value=!0,c("show"))}function le(){M.value=!1,c("close")}function ie(t){c("switch",t)}return me(()=>d.src,()=>{H.value?(E.value=!0,R.value=!1,J(),A()):j()}),Ce(()=>{H.value?A():j()}),B({showPreview:Q}),(t,h)=>(y(),S("div",be({ref_key:"container",ref:P},e(Y),{class:[e(g).b(),t.$attrs.class]}),[R.value?x(t.$slots,"error",{key:0},()=>[b("div",{class:m(e(g).e("error"))},Ee(e(o)("el.image.error")),3)]):(y(),S(ae,{key:1},[s.value!==void 0?(y(),S("img",be({key:0},e(se),{src:s.value,loading:t.loading,style:e(oe),class:e(r),crossorigin:t.crossorigin,onClick:Q,onLoad:ne,onError:re}),null,16,["src","loading","crossorigin"])):C("v-if",!0),E.value?(y(),S("div",{key:1,class:m(e(g).e("wrapper"))},[x(t.$slots,"placeholder",{},()=>[b("div",{class:m(e(g).e("placeholder"))},null,2)])],2)):C("v-if",!0)],64)),e(X)?(y(),S(ae,{key:2},[M.value?(y(),ve(e(ba),{key:0,"z-index":t.zIndex,"initial-index":e(Z),infinite:t.infinite,"zoom-rate":t.zoomRate,"min-scale":t.minScale,"max-scale":t.maxScale,"show-progress":t.showProgress,"url-list":t.previewSrcList,crossorigin:t.crossorigin,"hide-on-click-modal":t.hideOnClickModal,teleported:t.previewTeleported,"close-on-press-escape":t.closeOnPressEscape,onClose:le,onSwitch:ie},{progress:p(L=>[x(t.$slots,"progress",ke(Ie(L)))]),toolbar:p(L=>[x(t.$slots,"toolbar",ke(Ie(L)))]),default:p(()=>[t.$slots.viewer?(y(),S("div",{key:0},[x(t.$slots,"viewer")])):C("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):C("v-if",!0)],64)):C("v-if",!0)],16))}});var La=_e(Ea,[["__file","image.vue"]]);const Xa=Ne(La);export{Xa as E};
