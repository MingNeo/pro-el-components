import{usePageStorage as s}from"./index.DvqJRZSB.js";import{d as r,b as g,i as o,g as a,v as m}from"./vi.JYQecGiw.CsLlcVZs.js";import"./framework.igcgEEdr.js";import"./commonjsHelpers.BosuxZz1.js";import"./vite-browser-external_commonjs-proxy.BC9WSf1a.js";Object.defineProperty(window,"location",{value:{pathname:"_test-page"},writable:!0});r("usePageStorage",()=>{g(()=>{sessionStorage.clear()}),o("应该返回正确的属性和方法",()=>{const{data:e,clear:t,save:n,load:i}=s({count:0});a(e.value).toEqual({count:0}),a(typeof t).toBe("function"),a(typeof n).toBe("function"),a(typeof i).toBe("function")}),o("应该使用初始值",()=>{const e={name:"test",count:10},{data:t}=s(e);a(t.value).toEqual(e)}),o("应该支持自定义存储键",()=>{const{save:e}=s({value:"test"},{key:"custom-key"});e({value:"saved"});const t=sessionStorage.getItem("page_storage_custom-key");a(t).toBeDefined(),a(JSON.parse(t)).toEqual({timestamp:a.any(Number),data:{value:"saved"}})}),o("应该使用路由路径作为默认存储键",()=>{const{save:e}=s({value:"test"});e({value:"saved"});const t=sessionStorage.getItem("page_storage__test-page");a(t).toBeDefined()}),o("应该能保存数据到 sessionStorage",()=>{const{save:e}=s({count:0});e({count:5});const t=sessionStorage.getItem("page_storage__test-page");a(t).toBeDefined(),a(JSON.parse(t)).toEqual({timestamp:a.any(Number),data:{count:5}})}),o("应该能从 sessionStorage 加载数据",()=>{const e={name:"loaded",value:100},{data:t,load:n}=s({name:"",value:0},{immediate:!1});sessionStorage.setItem("page_storage__test-page",JSON.stringify({timestamp:a.any(Number),data:e})),a(t.value).toEqual({name:"",value:0}),n(),a(t.value).toEqual(e)}),o("应该能清除存储的数据",()=>{const{save:e,clear:t}=s({count:0});e({count:5}),a(sessionStorage.getItem("page_storage__test-page")).toBeDefined(),t(),a(sessionStorage.getItem("page_storage__test-page")).toBeNull()}),o("immediate 为 false 时不应该立即加载数据",()=>{sessionStorage.setItem("page_storage__test-page",JSON.stringify({count:10}));const{data:e}=s({count:0},{immediate:!1});a(e.value).toEqual({count:0})}),o("应该处理 JSON 解析错误",()=>{sessionStorage.setItem("page_storage__test-page","invalid json");const e=m.spyOn(console,"error").mockImplementation(()=>{}),{load:t}=s({count:0});t(),a(e).toHaveBeenCalled(),e.mockRestore()}),o("应该支持深度嵌套的对象",()=>{const e={user:{name:"test",settings:{theme:"dark",notifications:!0}},list:[1,2,3]},{save:t,load:n,data:i}=s({},{immediate:!1});t(e),i.value={},n(),a(i.value).toEqual(e)}),o("应该支持不同类型的数据",()=>{[{input:{str:"string"}},{input:{num:123}},{input:{bool:!0}},{input:{arr:[1,2,3]}},{input:{obj:{nested:"value"}}},{input:{nul:null}}].forEach(({input:t})=>{const{save:n,load:i,data:l}=s({},{immediate:!1,key:`test-${Math.random()}`});n(t),l.value={},i(),a(l.value).toEqual(t)})}),o("存储键应该隔离不同页面的数据",()=>{const e={page:"page1",value:1},t={page:"page2",value:2},{save:n}=s({},{key:"page1"}),{save:i}=s({},{key:"page2"});n(e),i(t);const l=JSON.parse(sessionStorage.getItem("page_storage_page1")),u=JSON.parse(sessionStorage.getItem("page_storage_page2"));a(l).toEqual({timestamp:a.any(Number),data:e}),a(u).toEqual({timestamp:a.any(Number),data:t})}),o("数据为空时也应该正确存储",()=>{const{save:e,load:t,data:n}=s({value:"initial"},{immediate:!1});e({}),n.value={value:"initial"},t(),a(n.value).toEqual({})})});
