import{r as _,Y as D}from"./pro-el-components.es.D2RWaTV6.js";import"./base.D1hT_OMg.js";import{b as M,a as T,E as F}from"./el-select.DD745kxU.js";import"./el-tag.eG6nSIS7.js";import"./el-scrollbar.D7CKjqK8.js";import"./el-popper.DVtARkBh.js";import{d as y}from"./debounce.BwFge-ki.js";import{d as H,p as i,v as Y,q as S,b as k,c as w,o as c,w as B,B as $,k as u,F as V,a as L,t as O,K as j}from"./framework.CCndWvNN.js";function q(s,m){return s&&s.length?_(s,M(m)):[]}const W=H({name:"ProRemoteSelect",inheritAttrs:!1,__name:"index",props:{service:{},fillBackService:{},optionNames:{default:()=>({label:"name",value:"id"})},defaultOptions:{},searchInLocal:{type:Boolean,default:!1},searchKey:{default:"keyword"},viewMode:{type:Boolean},onOptionsChanged:{},deps:{},modelValue:{},multiple:{type:Boolean}},emits:["loaded","firstLoaded"],setup(s,{emit:m}){const e=s,v=m,d=i(1),f=i(0),h=i(""),g=i(0),t=i([]),{execute:C,isLoading:N}=D(e.service,{immediate:!1});function p(a=[]){return a.map(l=>({...l,[`_${e.optionNames.label}`]:l[e.optionNames.label],[e.optionNames.label]:l[e.optionNames.label]}))}async function r(a=!1){var b;const l={pageNo:d.value,pageSize:10};a&&e.searchKey&&(l[e.searchKey]=h.value);const o=await C(l),n=p(o==null?void 0:o.data);t.value=a?n:q([...t.value,...n].reverse(),e.optionNames.value).reverse(),(b=e.onOptionsChanged)==null||b.call(e,t.value),f.value=(o==null?void 0:o.total)??0,v("loaded",t.value),g.value===0&&v("firstLoaded",t.value),g.value++}Y(()=>{t.value=p(e.defaultOptions),r()}),S(()=>e.modelValue,async a=>{var o;const l=a!==void 0?e.multiple?a:[a]:[];if(l.length){const n=await((o=e.fillBackService)==null?void 0:o.call(e,l))||[];t.value=q([...t.value,...p(n)],e.optionNames.value)}},{immediate:!0}),S(()=>e.deps,()=>r(!0));const E=y(()=>{const a=document.querySelector(".el-select-dropdown__wrap");a&&a.scrollHeight-a.scrollTop===a.clientHeight&&t.value.length<f.value&&(d.value++,r())},500,{leading:!0,trailing:!1}),I=y(()=>{d.value=1,r(!0)},1e3);function K(a){h.value=a,e.searchInLocal||I()}function P(){var a;return e.modelValue?e.multiple?e.modelValue.map(l=>{var o;return((o=t.value.find(n=>n[e.optionNames.value]===l))==null?void 0:o[e.optionNames.label])||l}).join("；"):((a=t.value.find(l=>l[e.optionNames.value]===e.modelValue))==null?void 0:a[e.optionNames.label])||e.modelValue:"-无-"}return(a,l)=>a.viewMode?(c(),w(V,{key:1},[L(O(P()),1)],64)):(c(),k(u(F),j({key:0,"model-value":a.modelValue},a.$attrs,{loading:u(N),remote:!a.searchInLocal,"remote-method":K,onPopupScroll:u(E)}),{empty:B(()=>[L(O(u(N)?"":"无数据"),1)]),default:B(()=>[(c(!0),w(V,null,$(t.value,o=>(c(),k(u(T),{key:o[a.optionNames.value],label:o[a.optionNames.label],value:o[a.optionNames.value]},null,8,["label","value"]))),128))]),_:1},16,["model-value","loading","remote","onPopupScroll"]))}});export{W as _};
