import"./base.BdmgHdsK.js";import{E as m}from"./el-button.DE4WLPFu.js";import{E as N}from"./el-overlay.BqfQhs6e.js";import{q as S,a as R}from"./pro-el-components.es.BbdLL6xm.js";import{unbind as n}from"./index.B6On7QUW.js";import{d as q,p as g,h as I,q as T,b as p,o as r,w as s,a2 as U,ao as j,c,G as v,r as u,e as G,k as d,K as h,j as K,B as L,a as w,t as C,F as B,P as z}from"./framework.C7SOrqHQ.js";const A={class:"dialog-footer"},Z=q({name:"ProModalForm",__name:"index",props:{title:{},width:{default:500},modelValue:{type:Boolean},loading:{type:Boolean,default:!1},defaultValue:{default:()=>({})},formData:{},viewMode:{type:Boolean},fields:{},column:{default:2},propPrefix:{},formProps:{},formItemProps:{},closeOnSuccess:{type:Boolean,default:!0},resetOnClose:{type:Boolean,default:!0},actions:{}},emits:["update:modelValue","update:formData","formChange","ok","cancel"],setup(D,{expose:P,emit:F}){const o=D,l=F,t=g(),k=g(n(o.defaultValue)),a=I({get:()=>o.formData??k.value,set:e=>{k.value=e,l("update:formData",e),l("formChange",e)}});T(()=>o.defaultValue,e=>{a.value=n(e)},{deep:!0});async function y(){var e;try{o.viewMode||await((e=t.value)==null?void 0:e.validate()),l("ok",a.value),(o.viewMode||o.closeOnSuccess)&&l("update:modelValue",!1)}catch(i){console.error("Form validation failed:",i)}}function f(){l("update:modelValue",!1),l("cancel"),o.resetOnClose&&(a.value=n(o.defaultValue))}function V(e){a.value=e}function E(e){z(()=>{o.resetOnClose&&(a.value=n(o.defaultValue))}),e()}return P({formRef:t,formData:a,resetForm:()=>{var e;return(e=t.value)==null?void 0:e.resetFields()},validate:()=>{var e;return(e=t.value)==null?void 0:e.validate()}}),(e,i)=>{const M=j("loading");return r(),p(d(N),h({class:"pro-modal-form","model-value":e.modelValue,width:e.width,title:e.title,"destroy-on-close":"","before-close":E},e.$attrs,{"onUpdate:modelValue":f}),{footer:s(()=>[u(e.$slots,"footer",{close:f,ok:y},()=>[K("div",A,[e.actions?(r(!0),c(B,{key:0},L(e.actions,({text:O,...b},$)=>(r(),p(d(m),h({key:$,ref_for:!0},b),{default:s(()=>[w(C(O),1)]),_:2},1040))),128)):(r(),c(B,{key:1},[v(d(m),{onClick:f},{default:s(()=>i[0]||(i[0]=[w(" 取消 ")])),_:1}),v(d(m),{type:"primary",onClick:y},{default:s(()=>[w(C(e.viewMode?"确定":"提交"),1)]),_:1})],64))])])]),default:s(()=>[U((r(),c("div",null,[v(d(R),h({ref_key:"formRef",ref:t,model:a.value,"label-width":"auto","label-position":"right"},e.formProps),{default:s(()=>[u(e.$slots,"header"),u(e.$slots,"default",{data:a.value,onChange:V,formRef:t.value},()=>[e.fields?(r(),p(d(S),{key:0,"model-value":a.value,column:e.column,"view-mode":e.viewMode,fields:e.fields,"form-item-props":e.formItemProps,"prop-prefix":e.propPrefix,"onUpdate:modelValue":V},null,8,["model-value","column","view-mode","fields","form-item-props","prop-prefix"])):G("",!0)]),u(e.$slots,"extra")]),_:3},16,["model"])])),[[M,e.loading]])]),_:3},16,["model-value","width","title"])}}});export{Z as _};
