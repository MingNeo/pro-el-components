import"./base.D1hT_OMg.js";import{Y as U,q as V,u as Y,p as F,z as H,a as j}from"./pro-el-components.es.D2RWaTV6.js";import{d as J,p as h,h as y,$ as O,q as B,c as d,o as l,r,a2 as Q,e as f,G as w,w as M,b as v,k as n,ao as T,n as E,F as W,B as X}from"./framework.CCndWvNN.js";const Z={class:"pro-detail-page"},x={key:0,class:"pro-detail-card"},te=J({name:"ProDetailPage",__name:"index",props:{title:{},defaultValue:{default:()=>({})},formData:{},viewMode:{type:Boolean},type:{},fields:{},extraFields:{},column:{default:2},formItemProps:{},idKey:{},loading:{type:Boolean},headerActions:{},footerActions:{},footerClass:{},showFooter:{type:Boolean,default:!0},contentClass:{},getDataService:{},updateService:{},createService:{}},emits:["update:visible","ok","update:formData","submit","back"],setup(L,{expose:P,emit:z}){const a=L,s=z,m=h(),t=h(a.formData??a.defaultValue),k=y(()=>a.type??(a.viewMode?"detail":t.value[a.idKey||"id"]?"edit":"create")),{execute:c,isLoading:D}=U(async(...e)=>{var o;return await((o=k.value==="edit"?a.updateService:a.createService)==null?void 0:o(...e))},{immediate:!1}),b=y(()=>{var e;return a.viewMode?[]:((Array.isArray(a.footerActions)?a.footerActions:(e=a.footerActions)==null?void 0:e.call(a,{submit:C,cancel:()=>s("back"),submitLoading:D.value}))||[{text:"取消",onClick:()=>{s("back")}},{text:"提交",type:"primary",loading:D.value,onClick:C}]).map(o=>({...o,args:[t]}))}),{footer:I}=O(),R=y(()=>{var e;return(a.showFooter??!a.viewMode)&&!!((e=b.value)!=null&&e.length||I)});B(()=>a.defaultValue,e=>{a.formData||(t.value=e,s("update:formData",t.value))},{deep:!0}),B(()=>a.formData,e=>t.value=e,{deep:!0});async function C(){if(!a.viewMode)try{const e=await m.value.validate();s("update:formData",t.value),await(c==null?void 0:c(t.value)),s("submit",e),s("ok",t.value)}catch(e){console.log("error",e)}}function p(e,o=!1){t.value=o?{...t.value,...e}:e,s("update:formData",t.value)}async function q(e=[]){e!=null&&e.length&&await m.value.validate(e),await m.value.validate()}P({validField:q});const g=h(!1);return a.getDataService&&(g.value=!0,a.getDataService().then(e=>{t.value=e,s("update:formData",t.value)}).finally(()=>{g.value=!1})),(e,o)=>{const G=T("loading");return l(),d("div",Z,[r(e.$slots,"header",{},()=>[w(n(Y),{title:typeof e.title=="function"?e.title(k.value):e.title,"show-back":!0,onCancel:o[0]||(o[0]=u=>s("back"))},{actions:M(()=>[r(e.$slots,"headerActions",{},()=>{var u;return[(u=e.headerActions)!=null&&u.length?(l(),v(n(V),{key:0,actions:e.headerActions},null,8,["actions"])):f("",!0)]})]),_:3},8,["title"])]),Q((l(),d("div",{class:E(`page-detail-content page-container ${e.contentClass||""}`)},[w(n(j),{ref_key:"formRef",ref:m,model:t.value,"label-width":"auto","label-position":"right"},{default:M(()=>[r(e.$slots,"contentHeader"),r(e.$slots,"default",{data:t.value,onChange:p,formRef:m.value},()=>{var u,S,$;return[(u=e.fields)!=null&&u.length||(S=e.extraFields)!=null&&S.length||e.$slots.contentExtra?(l(),d("div",x,[($=e.fields)!=null&&$.length?(l(),v(n(F),{key:0,modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=i=>t.value=i),column:e.column,"view-mode":e.viewMode,fields:e.fields,"form-item-props":e.formItemProps,onChange:p},null,8,["modelValue","column","view-mode","fields","form-item-props"])):f("",!0),(l(!0),d(W,null,X(e.extraFields,(i,K)=>{var A;return l(),d("div",{key:K,class:"extra-field-section"},[i.title?(l(),v(n(H),{key:0,class:"extra-field-header",title:i.title,actions:i.actions},null,8,["title","actions"])):f("",!0),(A=i.fields)!=null&&A.length?(l(),v(n(F),{key:1,modelValue:t.value,"onUpdate:modelValue":o[2]||(o[2]=N=>t.value=N),column:e.column,"view-mode":e.viewMode,fields:i.fields,"form-item-props":e.formItemProps,onChange:p},null,8,["modelValue","column","view-mode","fields","form-item-props"])):f("",!0)])}),128)),r(e.$slots,"contentExtra")])):f("",!0)]}),r(e.$slots,"pageExtra")]),_:3},8,["model"])],2)),[[G,e.loading||g.value]]),R.value?(l(),d("div",{key:0,class:E(`page-detail-footer ${e.footerClass||""}`)},[r(e.$slots,"footer",{},()=>[w(n(V),{type:"button",size:"default",actions:b.value,args:[t.value]},null,8,["actions","args"])])],2)):f("",!0)])}}});export{te as _};
